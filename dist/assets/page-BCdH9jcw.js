import{r as h,j as e,D as U,v as O,w as R,x as Z,af as u,ag as _,E as D,H as A,I as L,J as P,K as l,aR as te,f,P as z,B as k,a1 as re,ai as F,C as j,a as T,d as b,F as q,g as v,aU as K,p as le,m as $,q as V,U as H,e as ie,aq as ne,ar as oe,as as ce,av as E,Z as de}from"./index-D2dOrPZ8.js";import{T as xe,a as me,b as I,c as C,d as he,e as w}from"./table-DSYZvwhV.js";import{D as ue}from"./data-table-BARJs-tp.js";import{D as je}from"./download--rFCaPFG.js";import{E as ve}from"./ellipsis-C1yMrSu8.js";import{S as pe}from"./square-pen-Bi43ABVd.js";import"./skeleton-D4sfmQAY.js";function B({open:d,onOpenChange:m,term:n,onSave:N}){const[i,o]=h.useState({title:n?.title||"",content:n?.content||"",version:n?.version||"1.0",type:n?.type||"terms_of_service",is_mandatory:n?.is_mandatory??!0,is_active:n?.is_active??!0,conditions:n?.conditions||{}}),[x,c]=h.useState({field:"",operator:"",value:""}),s=()=>{N(i),m(!1)},p=()=>{x.field&&x.operator&&x.value&&(o(r=>({...r,conditions:{...r.conditions,[x.field]:{operator:x.operator,value:x.value}}})),c({field:"",operator:"",value:""}))},g=r=>{o(a=>{const S={...a.conditions};return delete S[r],{...a,conditions:S}})};return e.jsx(U,{open:d,onOpenChange:m,children:e.jsxs(O,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(R,{children:e.jsx(Z,{children:n?"Editar Termo":"Novo Termo"})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"title",children:"Título"}),e.jsx(_,{id:"title",value:i.title,onChange:r=>o(a=>({...a,title:r.target.value})),placeholder:"Título do termo"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"version",children:"Versão"}),e.jsx(_,{id:"version",value:i.version,onChange:r=>o(a=>({...a,version:r.target.value})),placeholder:"1.0"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Tipo"}),e.jsxs(D,{value:i.type,onValueChange:r=>o(a=>({...a,type:r})),children:[e.jsx(A,{children:e.jsx(L,{})}),e.jsxs(P,{children:[e.jsx(l,{value:"terms_of_service",children:"Termos de Serviço"}),e.jsx(l,{value:"privacy_policy",children:"Política de Privacidade"}),e.jsx(l,{value:"data_processing",children:"Processamento de Dados"}),e.jsx(l,{value:"cookie_policy",children:"Política de Cookies"}),e.jsx(l,{value:"user_agreement",children:"Acordo de Usuário"}),e.jsx(l,{value:"partner_agreement",children:"Acordo de Parceiro"}),e.jsx(l,{value:"nomade_agreement",children:"Acordo de Nômade"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"content",children:"Conteúdo"}),e.jsx(te,{id:"content",value:i.content,onChange:r=>o(a=>({...a,content:r.target.value})),placeholder:"Conteúdo do termo...",rows:10,className:"font-mono text-sm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Condições de Exibição"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(D,{value:x.field,onValueChange:r=>c(a=>({...a,field:r})),children:[e.jsx(A,{className:"flex-1",children:e.jsx(L,{placeholder:"Campo"})}),e.jsxs(P,{children:[e.jsx(l,{value:"account_type",children:"Tipo de Conta"}),e.jsx(l,{value:"account_level",children:"Nível da Conta"}),e.jsx(l,{value:"feature_access",children:"Acesso a Funcionalidade"}),e.jsx(l,{value:"registration_date",children:"Data de Cadastro"}),e.jsx(l,{value:"location",children:"Localização"})]})]}),e.jsxs(D,{value:x.operator,onValueChange:r=>c(a=>({...a,operator:r})),children:[e.jsx(A,{className:"flex-1",children:e.jsx(L,{placeholder:"Operador"})}),e.jsxs(P,{children:[e.jsx(l,{value:"equals",children:"Igual a"}),e.jsx(l,{value:"not_equals",children:"Diferente de"}),e.jsx(l,{value:"contains",children:"Contém"}),e.jsx(l,{value:"greater_than",children:"Maior que"}),e.jsx(l,{value:"less_than",children:"Menor que"})]})]}),e.jsx(_,{className:"flex-1",value:x.value,onChange:r=>c(a=>({...a,value:r.target.value})),placeholder:"Valor"}),e.jsx(f,{type:"button",onClick:p,children:e.jsx(z,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(i.conditions).map(([r,a])=>e.jsxs(k,{variant:"secondary",className:"flex items-center gap-1",children:[r," ",a.operator," ",a.value,e.jsx(re,{className:"h-3 w-3 cursor-pointer",onClick:()=>g(r)})]},r))})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:"mandatory",checked:i.is_mandatory,onCheckedChange:r=>o(a=>({...a,is_mandatory:r}))}),e.jsx(u,{htmlFor:"mandatory",children:"Aceite Obrigatório"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:"active",checked:i.is_active,onCheckedChange:r=>o(a=>({...a,is_active:r}))}),e.jsx(u,{htmlFor:"active",children:"Ativo"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(f,{variant:"outline",onClick:()=>m(!1),children:"Cancelar"}),e.jsx(f,{onClick:s,children:"Salvar"})]})]})})}function ge({open:d,onOpenChange:m,condition:n,onSave:N}){const[i,o]=h.useState({name:n?.name||"",field:n?.field||"",operator:n?.operator||"equals",value:n?.value||"",description:n?.description||""}),x=()=>{N(i),m(!1)};return e.jsx(U,{open:d,onOpenChange:m,children:e.jsxs(O,{className:"max-w-lg",children:[e.jsx(R,{children:e.jsx(Z,{children:n?"Editar Condição":"Nova Condição"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"name",children:"Nome da Condição"}),e.jsx(_,{id:"name",value:i.name,onChange:c=>o(s=>({...s,name:c.target.value})),placeholder:"Nome identificador"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Campo"}),e.jsxs(D,{value:i.field,onValueChange:c=>o(s=>({...s,field:c})),children:[e.jsx(A,{children:e.jsx(L,{placeholder:"Selecione o campo"})}),e.jsxs(P,{children:[e.jsx(l,{value:"account_type",children:"Tipo de Conta"}),e.jsx(l,{value:"account_level",children:"Nível da Conta"}),e.jsx(l,{value:"feature_access",children:"Acesso a Funcionalidade"}),e.jsx(l,{value:"registration_date",children:"Data de Cadastro"}),e.jsx(l,{value:"location",children:"Localização"}),e.jsx(l,{value:"project_count",children:"Número de Projetos"}),e.jsx(l,{value:"subscription_plan",children:"Plano de Assinatura"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Operador"}),e.jsxs(D,{value:i.operator,onValueChange:c=>o(s=>({...s,operator:c})),children:[e.jsx(A,{children:e.jsx(L,{})}),e.jsxs(P,{children:[e.jsx(l,{value:"equals",children:"Igual a"}),e.jsx(l,{value:"not_equals",children:"Diferente de"}),e.jsx(l,{value:"contains",children:"Contém"}),e.jsx(l,{value:"not_contains",children:"Não contém"}),e.jsx(l,{value:"greater_than",children:"Maior que"}),e.jsx(l,{value:"less_than",children:"Menor que"}),e.jsx(l,{value:"greater_equal",children:"Maior ou igual"}),e.jsx(l,{value:"less_equal",children:"Menor ou igual"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"value",children:"Valor"}),e.jsx(_,{id:"value",value:i.value,onChange:c=>o(s=>({...s,value:c.target.value})),placeholder:"Valor para comparação"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"description",children:"Descrição"}),e.jsx(_,{id:"description",value:i.description,onChange:c=>o(s=>({...s,description:c.target.value})),placeholder:"Descrição da condição (opcional)"})]}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Exemplo:"})," ",i.field&&i.operator&&i.value?`${i.field} ${i.operator} "${i.value}"`:"Configure os campos acima para ver o exemplo"]})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(f,{variant:"outline",onClick:()=>m(!1),children:"Cancelar"}),e.jsx(f,{onClick:x,children:"Salvar"})]})]})})}function fe({acceptances:d=[]}){const[m,n]=h.useState(""),[N,i]=h.useState(d),o=s=>{n(s);const p=d.filter(g=>g.user_name?.toLowerCase().includes(s.toLowerCase())||g.user_email?.toLowerCase().includes(s.toLowerCase())||g.term_title?.toLowerCase().includes(s.toLowerCase()));i(p)},x=()=>{const s=[["Usuário","Email","Termo","Versão","Data de Aceite","IP","Status"],...N.map(a=>[a.user_name||"",a.user_email||"",a.term_title||"",a.term_version||"",new Date(a.accepted_at).toLocaleString("pt-BR"),a.ip_address||"",a.is_current?"Atual":"Histórico"])].map(a=>a.join(",")).join(`
`),p=new Blob([s],{type:"text/csv"}),g=window.URL.createObjectURL(p),r=document.createElement("a");r.href=g,r.download=`historico-aceites-${new Date().toISOString().split("T")[0]}.csv`,r.click()},c=[{accessorKey:"user_name",header:"Usuário",cell:({row:s})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.original.user_name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.original.user_email})]})]})},{accessorKey:"term_title",header:"Termo",cell:({row:s})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.original.term_title}),e.jsxs("div",{className:"text-sm text-gray-500",children:["v",s.original.term_version]})]})]})},{accessorKey:"accepted_at",header:"Data de Aceite",cell:({row:s})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{children:new Date(s.original.accepted_at).toLocaleDateString("pt-BR")}),e.jsx("div",{className:"text-sm text-gray-500",children:new Date(s.original.accepted_at).toLocaleTimeString("pt-BR")})]})]})},{accessorKey:"ip_address",header:"IP",cell:({row:s})=>e.jsx("code",{className:"text-sm bg-gray-100 px-2 py-1 rounded",children:s.original.ip_address})},{accessorKey:"is_current",header:"Status",cell:({row:s})=>e.jsx(k,{variant:s.original.is_current?"default":"secondary",children:s.original.is_current?"Atual":"Histórico"})}];return e.jsxs(j,{children:[e.jsx(T,{children:e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Histórico de Aceites"]})}),e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(_,{placeholder:"Buscar por usuário, email ou termo...",value:m,onChange:s=>o(s.target.value),className:"pl-10"})]}),e.jsxs(f,{variant:"outline",onClick:x,children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Exportar CSV"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsx(j,{children:e.jsxs(v,{className:"p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:d.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Aceites"})]})}),e.jsx(j,{children:e.jsxs(v,{className:"p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:d.filter(s=>s.is_current).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Aceites Atuais"})]})}),e.jsx(j,{children:e.jsxs(v,{className:"p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:new Set(d.map(s=>s.user_id)).size}),e.jsx("div",{className:"text-sm text-gray-600",children:"Usuários Únicos"})]})}),e.jsx(j,{children:e.jsxs(v,{className:"p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:new Set(d.map(s=>s.term_id)).size}),e.jsx("div",{className:"text-sm text-gray-600",children:"Termos Diferentes"})]})})]}),e.jsx(ue,{columns:c,data:N,searchKey:"user_name"})]})]})}function Se(){const[d,m]=h.useState([]),[n,N]=h.useState(""),[i,o]=h.useState(null),[x,c]=h.useState(!1),[s,p]=h.useState(!1),[g,r]=h.useState(!1),[a,S]=h.useState(!1),[G,J]=h.useState(!0),X=[{id:"term-1",name:"Termos de Serviço Gerais",version:"2.1",content:"Conteúdo dos termos de serviço...",type:"terms_of_service",is_active:!0,created_at:"2024-01-15T10:00:00Z",updated_at:"2024-01-20T14:30:00Z",created_by:"admin-1",conditions:[{id:"cond-1",term_id:"term-1",condition_type:"account_type",condition_value:"agency",is_required:!0,created_at:"2024-01-15T10:00:00Z"}]},{id:"term-2",name:"Política de Privacidade",version:"1.5",content:"Conteúdo da política de privacidade...",type:"privacy_policy",is_active:!0,created_at:"2024-01-10T09:00:00Z",updated_at:"2024-01-18T16:45:00Z",created_by:"admin-1",conditions:[]},{id:"term-3",name:"Termos para Nômades Partner",version:"1.0",content:"Termos específicos para nômades Partner...",type:"custom",is_active:!0,created_at:"2024-01-25T11:00:00Z",updated_at:"2024-01-25T11:00:00Z",created_by:"admin-2",conditions:[{id:"cond-2",term_id:"term-3",condition_type:"account_level",condition_value:"partner",is_required:!0,created_at:"2024-01-25T11:00:00Z"}]}];h.useEffect(()=>{setTimeout(()=>{m(X),J(!1)},1e3)},[]);const Q=d.filter(t=>t.name.toLowerCase().includes(n.toLowerCase())||t.type.toLowerCase().includes(n.toLowerCase())),W=t=>({privacy_policy:"Política de Privacidade",terms_of_service:"Termos de Serviço",data_processing:"Processamento de Dados",service_agreement:"Acordo de Serviços",custom:"Personalizado"})[t]||t,Y=t=>({privacy_policy:"bg-blue-100 text-blue-800",terms_of_service:"bg-green-100 text-green-800",data_processing:"bg-purple-100 text-purple-800",service_agreement:"bg-orange-100 text-orange-800",custom:"bg-gray-100 text-gray-800"})[t]||"bg-gray-100 text-gray-800",ee=t=>{const y={id:`term-${Date.now()}`,name:t.name||"",version:"1.0",content:t.content||"",type:t.type||"custom",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),created_by:"current-admin",conditions:[]};m([...d,y]),c(!1)},se=t=>{if(!i)return;const y=d.map(M=>M.id===i.id?{...M,...t,updated_at:new Date().toISOString()}:M);m(y),p(!1),o(null)},ae=t=>{m(d.filter(y=>y.id!==t))};return G?e.jsx("div",{className:"container mx-auto p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-32 bg-gray-200 rounded"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Gestão de Termos"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie todos os termos e documentos legais da plataforma"})]}),e.jsxs(f,{onClick:()=>c(!0),children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Novo Termo"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(j,{children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(b,{className:"text-sm font-medium",children:"Total de Termos"}),e.jsx(q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.length}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[d.filter(t=>t.is_active).length," ativos"]})]})]}),e.jsxs(j,{children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(b,{className:"text-sm font-medium",children:"Com Condições"}),e.jsx(V,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.filter(t=>t.conditions.length>0).length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Termos condicionais"})]})]}),e.jsxs(j,{children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(b,{className:"text-sm font-medium",children:"Aceites Hoje"}),e.jsx(H,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"47"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+12% vs ontem"})]})]}),e.jsxs(j,{children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(b,{className:"text-sm font-medium",children:"Última Atualização"}),e.jsx($,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"2d"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Termos de Serviço"})]})]})]}),e.jsxs(j,{children:[e.jsxs(T,{children:[e.jsx(b,{children:"Termos Cadastrados"}),e.jsx(ie,{children:"Gerencie todos os termos e suas condições de exibição"})]}),e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(K,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(_,{placeholder:"Buscar termos...",value:n,onChange:t=>N(t.target.value),className:"pl-8"})]}),e.jsxs(f,{variant:"outline",onClick:()=>S(!0),children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Histórico de Aceites"]})]}),e.jsxs(xe,{children:[e.jsx(me,{children:e.jsxs(I,{children:[e.jsx(C,{children:"Nome"}),e.jsx(C,{children:"Tipo"}),e.jsx(C,{children:"Versão"}),e.jsx(C,{children:"Condições"}),e.jsx(C,{children:"Status"}),e.jsx(C,{children:"Atualizado"}),e.jsx(C,{className:"text-right",children:"Ações"})]})}),e.jsx(he,{children:Q.map(t=>e.jsxs(I,{children:[e.jsx(w,{className:"font-medium",children:t.name}),e.jsx(w,{children:e.jsx(k,{className:Y(t.type),children:W(t.type)})}),e.jsxs(w,{children:["v",t.version]}),e.jsx(w,{children:t.conditions.length>0?e.jsxs(k,{variant:"outline",children:[t.conditions.length," condição(ões)"]}):e.jsx("span",{className:"text-muted-foreground",children:"Nenhuma"})}),e.jsx(w,{children:e.jsx(k,{variant:t.is_active?"default":"secondary",children:t.is_active?"Ativo":"Inativo"})}),e.jsx(w,{children:new Date(t.updated_at).toLocaleDateString("pt-BR")}),e.jsx(w,{className:"text-right",children:e.jsxs(ne,{children:[e.jsx(oe,{asChild:!0,children:e.jsx(f,{variant:"ghost",className:"h-8 w-8 p-0",children:e.jsx(ve,{className:"h-4 w-4"})})}),e.jsxs(ce,{align:"end",children:[e.jsxs(E,{onClick:()=>{o(t),p(!0)},children:[e.jsx(pe,{className:"mr-2 h-4 w-4"}),"Editar"]}),e.jsxs(E,{onClick:()=>{o(t),r(!0)},children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),"Condições"]}),e.jsxs(E,{onClick:()=>ae(t.id),className:"text-red-600",children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),"Excluir"]})]})]})})]},t.id))})]})]})]}),e.jsx(B,{open:x,onOpenChange:c,onSave:ee,mode:"create"}),e.jsx(B,{open:s,onOpenChange:p,onSave:se,mode:"edit",term:i}),e.jsx(ge,{open:g,onOpenChange:r,term:i}),e.jsx(fe,{open:a,onOpenChange:S})]})}export{Se as default};
