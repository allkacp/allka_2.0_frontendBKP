import{r as o,j as e,O as q,Q as V,f as i,m as y,N as _,V as L,q as M,D as w,ax as B,P as J,v as S,w as C,x as D,T as H,h as U,i as E,k as R,y as Z,a2 as K,U as Q,z as W,C as x,g as u,a as P,d as T,F as Y,B as F,az as A,af as G,E as X,H as ee,I as ae,J as se,K as te}from"./index-D2dOrPZ8.js";import{C as re}from"./calendar-DwnGr2XM.js";import{P as le}from"./play-CxVld3XJ.js";import{S as ne}from"./square-pen-Bi43ABVd.js";import{D as ie}from"./download--rFCaPFG.js";import"./format-Dp_GGtXD.js";function ce(n,d){const c=new Date(n);return c.setDate(c.getDate()+d),c}function f(n,d){const t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][n.getMonth()],r=n.getDate(),m=n.getFullYear();return`${t} ${r.toString().padStart(2,"0")}, ${m}`}function oe({className:n,date:d,onDateChange:c}){const[t,r]=o.useState(d||{from:new Date,to:ce(new Date,7)}),m=h=>{r(h),c?.(h)};return e.jsx("div",{className:_("grid gap-2",n),children:e.jsxs(q,{children:[e.jsx(V,{asChild:!0,children:e.jsxs(i,{id:"date",variant:"outline",className:_("w-[300px] justify-start text-left font-normal",!t&&"text-muted-foreground"),children:[e.jsx(y,{className:"mr-2 h-4 w-4"}),t?.from?t.to?e.jsxs(e.Fragment,{children:[f(t.from)," - ",f(t.to)]}):f(t.from):e.jsx("span",{children:"Pick a date range"})]})}),e.jsx(L,{className:"w-auto p-0",align:"start",children:e.jsx(re,{initialFocus:!0,mode:"range",defaultMonth:t?.from,selected:t,onSelect:m,numberOfMonths:2})})]})})}const v=[{value:"performance",label:"Performance",icon:Z,color:"bg-blue-500"},{value:"financial",label:"Financeiro",icon:K,color:"bg-green-500"},{value:"operational",label:"Operacional",icon:Q,color:"bg-purple-500"},{value:"analytics",label:"Analytics",icon:W,color:"bg-orange-500"}],de=[{id:"agency_performance",name:"Relatório de Performance de Agências",description:"Análise detalhada da performance das agências parceiras",category:"performance",type:"standard",columns:[{id:"agency_name",name:"Agência",field:"agency_name",type:"text",sortable:!0,filterable:!0},{id:"projects_count",name:"Projetos",field:"projects_count",type:"number",sortable:!0,filterable:!1,aggregation:"sum"},{id:"revenue",name:"Receita",field:"revenue",type:"currency",sortable:!0,filterable:!1,aggregation:"sum"},{id:"completion_rate",name:"Taxa de Conclusão",field:"completion_rate",type:"percentage",sortable:!0,filterable:!1,aggregation:"avg"}],filters:[{id:"date_range",name:"Período",field:"date_range",type:"date_range",required:!0},{id:"agency_level",name:"Nível da Agência",field:"agency_level",type:"select",options:[{value:"basic",label:"Básico"},{value:"partner",label:"Partner"},{value:"premium",label:"Premium"}],required:!1}],charts:[{id:"revenue_chart",type:"bar",title:"Receita por Agência",x_axis:"agency_name",y_axis:"revenue",data_source:"main",config:{}}],export_formats:["excel","pdf","csv"],access_levels:["admin","comercial"],created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"sales_billing",name:"Relatório de Vendas e Faturamento",description:"Análise de vendas, receitas e faturamento da plataforma",category:"financial",type:"standard",columns:[{id:"period",name:"Período",field:"period",type:"date",sortable:!0,filterable:!0},{id:"total_sales",name:"Vendas Totais",field:"total_sales",type:"currency",sortable:!0,filterable:!1,aggregation:"sum"},{id:"recurring_revenue",name:"Receita Recorrente",field:"recurring_revenue",type:"currency",sortable:!0,filterable:!1,aggregation:"sum"},{id:"new_customers",name:"Novos Clientes",field:"new_customers",type:"number",sortable:!0,filterable:!1,aggregation:"sum"}],filters:[{id:"date_range",name:"Período",field:"date_range",type:"date_range",required:!0},{id:"customer_type",name:"Tipo de Cliente",field:"customer_type",type:"multiselect",options:[{value:"empresas",label:"Empresas"},{value:"agencias",label:"Agências"}],required:!1}],charts:[{id:"sales_trend",type:"line",title:"Tendência de Vendas",x_axis:"period",y_axis:"total_sales",data_source:"main",config:{}}],export_formats:["excel","pdf"],access_levels:["admin","financeiro"],created_at:new Date().toISOString(),updated_at:new Date().toISOString()}];function je(){const[n,d]=o.useState(de),[c,t]=o.useState([]),[r,m]=o.useState(null),[h,g]=o.useState(!1),[O,$]=o.useState(!1),[b,N]=o.useState(!1),[p,j]=o.useState({});o.useEffect(()=>{k()},[]);const k=async()=>{try{t([{id:"1",template_id:"agency_performance",name:"Performance Agências - Janeiro 2024",filters:{date_range:{from:"2024-01-01",to:"2024-01-31"}},status:"completed",executed_by:"admin",executed_at:"2024-01-31T10:00:00Z",completed_at:"2024-01-31T10:02:00Z",file_url:"/reports/agency_performance_jan2024.xlsx"}])}catch(a){console.error("Error loading report executions:",a)}},z=async()=>{if(r){N(!0);try{const a={id:`exec_${Date.now()}`,template_id:r.id,name:`${r.name} - ${new Date().toLocaleDateString()}`,filters:p,status:"running",executed_by:"current_user",executed_at:new Date().toISOString()};t(s=>[a,...s]),g(!1),j({}),setTimeout(()=>{t(s=>s.map(l=>l.id===a.id?{...l,status:"completed",completed_at:new Date().toISOString(),file_url:`/reports/${r.id}_${Date.now()}.xlsx`}:l))},3e3)}catch(a){console.error("Error executing report:",a)}finally{N(!1)}}},I=a=>{const l={pending:{color:"bg-gray-500",label:"Pendente"},running:{color:"bg-blue-500",label:"Executando"},completed:{color:"bg-green-500",label:"Concluído"},failed:{color:"bg-red-500",label:"Falhou"}}[a];return e.jsx(F,{className:`${l.color} text-white`,children:l.label})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Relatórios"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Análise detalhada de dados da plataforma"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(i,{variant:"outline",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Configurações"]}),e.jsxs(w,{open:O,onOpenChange:$,children:[e.jsx(B,{asChild:!0,children:e.jsxs(i,{children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Criar Relatório"]})}),e.jsxs(S,{className:"max-w-4xl",children:[e.jsx(C,{children:e.jsx(D,{children:"Criar Novo Relatório"})}),e.jsx("div",{className:"space-y-4",children:e.jsx("p",{className:"text-gray-600",children:"Funcionalidade de criação de relatórios personalizados em desenvolvimento."})})]})]})]})]}),e.jsxs(H,{defaultValue:"templates",className:"space-y-6",children:[e.jsxs(U,{children:[e.jsx(E,{value:"templates",children:"Modelos de Relatório"}),e.jsx(E,{value:"executions",children:"Execuções"})]}),e.jsxs(R,{value:"templates",className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:v.map(a=>{const s=n.filter(l=>l.category===a.value);return e.jsx(x,{className:"hover:shadow-md transition-shadow",children:e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:`p-2 ${a.color} rounded-lg`,children:e.jsx(a.icon,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:a.label}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.length," relatórios"]})]})]})})},a.value)})}),e.jsxs(x,{children:[e.jsx(P,{children:e.jsxs(T,{className:"flex items-center",children:[e.jsx(Y,{className:"h-5 w-5 mr-2"}),"Relatórios Padrão"]})}),e.jsx(u,{children:e.jsx("div",{className:"space-y-4",children:n.filter(a=>a.type==="standard").map(a=>e.jsx(x,{className:"border border-gray-200",children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h4",{className:"font-semibold",children:a.name}),e.jsx(F,{variant:"outline",className:v.find(s=>s.value===a.category)?.color.replace("bg-","text-")+" border-current",children:v.find(s=>s.value===a.category)?.label})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:a.description}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[e.jsxs("span",{children:[a.columns.length," colunas"]}),e.jsxs("span",{children:[a.filters.length," filtros"]}),e.jsxs("span",{children:[a.charts.length," gráficos"]}),e.jsxs("span",{children:["Exporta: ",a.export_formats.join(", ")]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>{m(a),g(!0)},children:[e.jsx(le,{className:"h-4 w-4 mr-1"}),"Executar"]}),e.jsx(i,{variant:"ghost",size:"sm",children:e.jsx(A,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"sm",children:e.jsx(ne,{className:"h-4 w-4"})})]})]})})},a.id))})})]})]}),e.jsx(R,{value:"executions",className:"space-y-6",children:e.jsxs(x,{children:[e.jsx(P,{children:e.jsxs(T,{className:"flex items-center",children:[e.jsx(y,{className:"h-5 w-5 mr-2"}),"Histórico de Execuções"]})}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-4",children:[c.map(a=>e.jsx(x,{className:"border border-gray-200",children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h4",{className:"font-semibold",children:a.name}),I(a.status)]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[e.jsxs("span",{children:["Executado por: ",a.executed_by]}),e.jsxs("span",{children:["Em: ",new Date(a.executed_at).toLocaleString()]}),a.completed_at&&e.jsxs("span",{children:["Concluído: ",new Date(a.completed_at).toLocaleString()]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[a.status==="completed"&&a.file_url&&e.jsxs(i,{variant:"outline",size:"sm",children:[e.jsx(ie,{className:"h-4 w-4 mr-1"}),"Download"]}),e.jsx(i,{variant:"ghost",size:"sm",children:e.jsx(A,{className:"h-4 w-4"})})]})]})})},a.id)),c.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(y,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Nenhuma execução de relatório encontrada"}),e.jsx("p",{className:"text-sm",children:"Execute um relatório para ver o histórico aqui"})]})]})})]})})]}),e.jsx(w,{open:h,onOpenChange:g,children:e.jsxs(S,{className:"max-w-2xl",children:[e.jsx(C,{children:e.jsx(D,{children:"Executar Relatório"})}),r&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:r.name}),e.jsx("p",{className:"text-sm text-gray-600",children:r.description})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h5",{className:"font-medium",children:"Filtros"}),r.filters.map(a=>e.jsxs("div",{children:[e.jsx(G,{htmlFor:a.id,children:a.name}),a.type==="date_range"&&e.jsx(oe,{value:p[a.id],onChange:s=>j(l=>({...l,[a.id]:s}))}),a.type==="select"&&e.jsxs(X,{value:p[a.id],onValueChange:s=>j(l=>({...l,[a.id]:s})),children:[e.jsx(ee,{children:e.jsx(ae,{placeholder:"Selecione..."})}),e.jsx(se,{children:a.options?.map(s=>e.jsx(te,{value:s.value,children:s.label},s.value))})]})]},a.id))]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(i,{variant:"outline",onClick:()=>g(!1),children:"Cancelar"}),e.jsx(i,{onClick:z,disabled:b,children:b?"Executando...":"Executar Relatório"})]})]})]})})]})}export{je as default};
