import{r as i,j as e,f,C as r,g as o,a2 as W,F as D,ao as L,af as l,E as Z,H as V,I as z,J as M,K as m,ag as O,B as w,az as X,n as E,m as J,D as Y,v as Q,w as U,x as q,ae as ee,a as y,d as b,l as ae,o as se,T as ne,h as te,i as $,k as G,aR as H}from"./index-D2dOrPZ8.js";import{A as le,a as ce}from"./alert-CVKN-O4u.js";import{D as ie}from"./download--rFCaPFG.js";import{T as S}from"./triangle-alert-Cjhkzg0C.js";import{C as I}from"./circle-x-D0uMI9ez.js";function je(){const[s,h]=i.useState([]),[x,k]=i.useState(null),[T,C]=i.useState(null),[g,R]=i.useState("kanban"),[c,u]=i.useState({status:"all",period:"all",agency:"",search:""}),[_,A]=i.useState(!0);i.useEffect(()=>{const a={total_pending_amount:45750,total_requests_count:23,requests_by_status:{aguardando_analise:8,pagamento_agendado:5,pagamento_efetuado:7,cancelado:2,reprovado:1},overdue_analysis:3,overdue_payment:1,monthly_volume:125e3,average_processing_time:4.2},n=[{id:1,agency_id:101,agency_name:"Agência Digital Pro",agency_cnpj:"12.345.678/0001-90",amount:5500,status:"aguardando_analise",requested_at:"2024-01-15T10:30:00Z",invoice_url:"/invoices/invoice-001.pdf",analysis_deadline:"2024-01-18T17:00:00Z",bank_account:{bank_name:"Banco do Brasil",agency:"1234-5",account:"12345-6",account_type:"checking",cnpj:"12.345.678/0001-90"}},{id:2,agency_id:102,agency_name:"Tech Solutions",agency_cnpj:"98.765.432/0001-10",amount:8200,status:"pagamento_agendado",requested_at:"2024-01-12T14:20:00Z",processed_at:"2024-01-14T09:15:00Z",payment_scheduled_date:"2024-01-19T00:00:00Z",analysis_deadline:"2024-01-15T17:00:00Z",payment_deadline:"2024-01-21T17:00:00Z",omie_payment_id:"OMI-2024-001",bank_account:{bank_name:"Itaú",agency:"5678",account:"98765-4",account_type:"checking",cnpj:"98.765.432/0001-10"}},{id:3,agency_id:103,agency_name:"Creative Agency",agency_cnpj:"11.222.333/0001-44",amount:3200,status:"reprovado",requested_at:"2024-01-10T16:45:00Z",processed_at:"2024-01-13T11:30:00Z",rejection_reason:"Nota fiscal com dados incorretos",correction_deadline:"2024-01-20T17:00:00Z",auto_cancel_date:"2024-01-20T17:00:00Z",analysis_deadline:"2024-01-13T17:00:00Z",bank_account:{bank_name:"Santander",agency:"9876",account:"54321-8",account_type:"savings",cnpj:"11.222.333/0001-44"}}];k(a),h(n),A(!1)},[]);const N=a=>({aguardando_analise:{label:"Aguardando Análise",color:"bg-yellow-100 text-yellow-800 border-yellow-200",icon:L},pagamento_agendado:{label:"Pagamento Agendado",color:"bg-blue-100 text-blue-800 border-blue-200",icon:J},pagamento_efetuado:{label:"Pagamento Efetuado",color:"bg-green-100 text-green-800 border-green-200",icon:E},cancelado:{label:"Cancelado",color:"bg-gray-100 text-gray-800 border-gray-200",icon:I},reprovado:{label:"Reprovado",color:"bg-red-100 text-red-800 border-red-200",icon:S}})[a],v=a=>{const n=new Date;return a.status==="aguardando_analise"?new Date(a.analysis_deadline)<n:a.status==="pagamento_agendado"&&a.payment_deadline?new Date(a.payment_deadline)<n:!1},j=async(a,n,p)=>{console.log("[v0] Status change:",{requestId:a,newStatus:n,data:p}),h(d=>d.map(F=>F.id===a?{...F,status:n,processed_at:new Date().toISOString(),...p}:F))},B=async a=>{console.log("[v0] Generating Omie payment for request:",a.id);const n={id:`OMI-${new Date().getFullYear()}-${String(a.id).padStart(3,"0")}`,withdrawal_request_id:a.id,amount:a.amount,recipient:{name:a.agency_name,cnpj:a.agency_cnpj,bank_account:{bank_code:P(a.bank_account.bank_name),agency:a.bank_account.agency,account:a.bank_account.account,account_type:a.bank_account.account_type}},scheduled_date:a.payment_scheduled_date||new Date(Date.now()+10080*60*1e3).toISOString(),status:"pending",created_at:new Date().toISOString()};return await new Promise(p=>setTimeout(p,1e3)),n},P=a=>({"Banco do Brasil":"001",Itaú:"341",Santander:"033",Caixa:"104",Bradesco:"237"})[a]||"000",t=s.filter(a=>!(c.status!=="all"&&a.status!==c.status||c.agency&&!a.agency_name.toLowerCase().includes(c.agency.toLowerCase())||c.search&&!a.agency_name.toLowerCase().includes(c.search.toLowerCase())&&!a.agency_cnpj.includes(c.search))),K={aguardando_analise:t.filter(a=>a.status==="aguardando_analise"),pagamento_agendado:t.filter(a=>a.status==="pagamento_agendado"),pagamento_efetuado:t.filter(a=>a.status==="pagamento_efetuado"),cancelado:t.filter(a=>a.status==="cancelado"),reprovado:t.filter(a=>a.status==="reprovado")};return _?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Solicitações de Saque"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gerencie todas as solicitações de saque da plataforma"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{variant:"outline",onClick:()=>R(g==="list"?"kanban":"list"),children:g==="list"?"Visualização Kanban":"Visualização Lista"}),e.jsxs(f,{variant:"outline",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Exportar"]})]})]}),x&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(r,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Valor Pendente"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["R$ ",x.total_pending_amount.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]}),e.jsx(W,{className:"h-8 w-8 text-blue-500"})]})})}),e.jsx(r,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total de Solicitações"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:x.total_requests_count})]}),e.jsx(D,{className:"h-8 w-8 text-gray-500"})]})})}),e.jsx(r,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Análises Atrasadas"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:x.overdue_analysis})]}),e.jsx(S,{className:"h-8 w-8 text-red-500"})]})})}),e.jsx(r,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Tempo Médio"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[x.average_processing_time," dias"]})]}),e.jsx(L,{className:"h-8 w-8 text-green-500"})]})})})]}),e.jsx(r,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"status-filter",children:"Status"}),e.jsxs(Z,{value:c.status,onValueChange:a=>u(n=>({...n,status:a})),children:[e.jsx(V,{children:e.jsx(z,{placeholder:"Todos os status"})}),e.jsxs(M,{children:[e.jsx(m,{value:"all",children:"Todos os status"}),e.jsx(m,{value:"aguardando_analise",children:"Aguardando Análise"}),e.jsx(m,{value:"pagamento_agendado",children:"Pagamento Agendado"}),e.jsx(m,{value:"pagamento_efetuado",children:"Pagamento Efetuado"}),e.jsx(m,{value:"reprovado",children:"Reprovado"}),e.jsx(m,{value:"cancelado",children:"Cancelado"})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"period-filter",children:"Período"}),e.jsxs(Z,{value:c.period,onValueChange:a=>u(n=>({...n,period:a})),children:[e.jsx(V,{children:e.jsx(z,{placeholder:"Todos os períodos"})}),e.jsxs(M,{children:[e.jsx(m,{value:"all",children:"Todos os períodos"}),e.jsx(m,{value:"today",children:"Hoje"}),e.jsx(m,{value:"week",children:"Esta semana"}),e.jsx(m,{value:"month",children:"Este mês"}),e.jsx(m,{value:"quarter",children:"Este trimestre"})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"agency-filter",children:"Agência"}),e.jsx(O,{id:"agency-filter",placeholder:"Filtrar por agência...",value:c.agency,onChange:a=>u(n=>({...n,agency:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"search",children:"Busca Geral"}),e.jsx(O,{id:"search",placeholder:"CNPJ, nome da agência...",value:c.search,onChange:a=>u(n=>({...n,search:a.target.value}))})]})]})})}),g==="kanban"?e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-6",children:Object.entries(K).map(([a,n])=>{const p=N(a);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p.icon,{className:"h-5 w-5"}),e.jsx("h3",{className:"font-semibold",children:p.label}),e.jsx(w,{variant:"secondary",children:n.length})]}),e.jsx("div",{className:"space-y-3",children:n.map(d=>e.jsx(r,{className:`cursor-pointer hover:shadow-md transition-shadow ${v(d)?"border-red-300 bg-red-50":""}`,onClick:()=>C(d),children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"font-medium text-sm",children:d.agency_name}),v(d)&&e.jsx(S,{className:"h-4 w-4 text-red-500"})]}),e.jsx("p",{className:"text-xs text-gray-600",children:d.agency_cnpj}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"font-bold text-green-600",children:["R$ ",d.amount.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(d.requested_at).toLocaleDateString("pt-BR")})]}),d.invoice_url&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-blue-600",children:[e.jsx(D,{className:"h-3 w-3"}),"NF anexada"]})]})})},d.id))})]},a)})}):e.jsx(r,{children:e.jsx(o,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-4 font-semibold",children:"Agência"}),e.jsx("th",{className:"text-left p-4 font-semibold",children:"Valor"}),e.jsx("th",{className:"text-left p-4 font-semibold",children:"Status"}),e.jsx("th",{className:"text-left p-4 font-semibold",children:"Solicitado em"}),e.jsx("th",{className:"text-left p-4 font-semibold",children:"Prazo"}),e.jsx("th",{className:"text-left p-4 font-semibold",children:"Ações"})]})}),e.jsx("tbody",{children:t.map(a=>{const n=N(a.status);return e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.agency_name}),e.jsx("p",{className:"text-sm text-gray-600",children:a.agency_cnpj})]})}),e.jsxs("td",{className:"p-4 font-bold text-green-600",children:["R$ ",a.amount.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsx("td",{className:"p-4",children:e.jsxs(w,{className:n.color,children:[e.jsx(n.icon,{className:"h-3 w-3 mr-1"}),n.label]})}),e.jsx("td",{className:"p-4 text-sm text-gray-600",children:new Date(a.requested_at).toLocaleDateString("pt-BR")}),e.jsx("td",{className:"p-4",children:v(a)?e.jsx(w,{className:"bg-red-100 text-red-800",children:"Atrasado"}):e.jsx("span",{className:"text-sm text-gray-600",children:new Date(a.analysis_deadline).toLocaleDateString("pt-BR")})}),e.jsx("td",{className:"p-4",children:e.jsx(f,{variant:"outline",size:"sm",onClick:()=>C(a),children:e.jsx(X,{className:"h-4 w-4"})})})]},a.id)})})]})})})}),T&&e.jsx(re,{request:T,onClose:()=>C(null),onStatusChange:j,onGenerateOmiePayment:B})]})}function re({request:s,onClose:h,onStatusChange:x,onGenerateOmiePayment:k}){const[T,C]=i.useState(s.status),[g,R]=i.useState(s.notes||""),[c,u]=i.useState(""),[_,A]=i.useState(""),[N,v]=i.useState(!1),j=oe(s.status),B=async()=>{v(!0);try{const t=await k(s);x(s.id,"pagamento_agendado",{payment_scheduled_date:c||new Date(Date.now()+10080*60*1e3).toISOString(),omie_payment_id:t.id,notes:g}),h()}catch(t){console.error("Erro ao aprovar solicitação:",t)}finally{v(!1)}},P=()=>{x(s.id,"reprovado",{rejection_reason:_,correction_deadline:new Date(Date.now()+10080*60*1e3).toISOString(),notes:g}),h()};return e.jsx(Y,{open:!0,onOpenChange:h,children:e.jsxs(Q,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(U,{children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(j.icon,{className:"h-5 w-5"}),"Solicitação de Saque #",s.id]}),e.jsxs(ee,{children:["Gerencie esta solicitação de saque da ",s.agency_name]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(w,{className:j.color,children:[e.jsx(j.icon,{className:"h-3 w-3 mr-1"}),j.label]}),s.omie_payment_id&&e.jsxs(w,{variant:"outline",children:["Omie: ",s.omie_payment_id]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(r,{children:[e.jsx(y,{children:e.jsxs(b,{className:"text-lg flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5"}),"Informações da Agência"]})}),e.jsxs(o,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium",children:"Nome"}),e.jsx("p",{className:"text-sm",children:s.agency_name})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium",children:"CNPJ"}),e.jsx("p",{className:"text-sm",children:s.agency_cnpj})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium",children:"Valor Solicitado"}),e.jsxs("p",{className:"text-lg font-bold text-green-600",children:["R$ ",s.amount.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium",children:"Data da Solicitação"}),e.jsx("p",{className:"text-sm",children:new Date(s.requested_at).toLocaleString("pt-BR")})]})]})]}),e.jsxs(r,{children:[e.jsx(y,{children:e.jsxs(b,{className:"text-lg flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5"}),"Dados Bancários"]})}),e.jsxs(o,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium",children:"Banco"}),e.jsx("p",{className:"text-sm",children:s.bank_account.bank_name})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium",children:"Agência"}),e.jsx("p",{className:"text-sm",children:s.bank_account.agency})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium",children:"Conta"}),e.jsx("p",{className:"text-sm",children:s.bank_account.account})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium",children:"Tipo"}),e.jsx("p",{className:"text-sm",children:s.bank_account.account_type==="checking"?"Conta Corrente":"Poupança"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium",children:"CNPJ da Conta"}),e.jsx("p",{className:"text-sm",children:s.bank_account.cnpj})]})]})]})]}),s.invoice_url&&e.jsxs(r,{children:[e.jsx(y,{children:e.jsxs(b,{className:"text-lg flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Documentos"]})}),e.jsx(o,{children:e.jsx(f,{variant:"outline",asChild:!0,children:e.jsxs("a",{href:s.invoice_url,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Visualizar Nota Fiscal"]})})})]}),s.status==="aguardando_analise"&&e.jsxs(r,{children:[e.jsx(y,{children:e.jsx(b,{className:"text-lg",children:"Ações"})}),e.jsx(o,{className:"space-y-4",children:e.jsxs(ne,{defaultValue:"approve",children:[e.jsxs(te,{children:[e.jsx($,{value:"approve",children:"Aprovar"}),e.jsx($,{value:"reject",children:"Reprovar"})]}),e.jsxs(G,{value:"approve",className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"payment-date",children:"Data de Pagamento (opcional)"}),e.jsx(O,{id:"payment-date",type:"date",value:c,onChange:t=>u(t.target.value)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Se não definida, será agendada para 7 dias úteis"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"approval-notes",children:"Observações"}),e.jsx(H,{id:"approval-notes",placeholder:"Observações sobre a aprovação...",value:g,onChange:t=>R(t.target.value)})]}),e.jsx(f,{onClick:B,className:"w-full bg-green-600 hover:bg-green-700",disabled:N,children:N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Aprovar e Gerar Ordem de Pagamento"]})})]}),e.jsxs(G,{value:"reject",className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"rejection-reason",children:"Motivo da Reprovação"}),e.jsx(H,{id:"rejection-reason",placeholder:"Descreva o motivo da reprovação...",value:_,onChange:t=>A(t.target.value),required:!0})]}),e.jsxs(le,{children:[e.jsx(S,{className:"h-4 w-4"}),e.jsx(ce,{children:"A agência terá 7 dias para corrigir a solicitação. Após esse prazo, ela será cancelada automaticamente."})]}),e.jsxs(f,{onClick:P,variant:"destructive",className:"w-full",disabled:!_.trim(),children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Reprovar Solicitação"]})]})]})})]}),e.jsxs(r,{children:[e.jsx(y,{children:e.jsx(b,{className:"text-lg",children:"Histórico"})}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{className:"text-gray-600",children:new Date(s.requested_at).toLocaleString("pt-BR")}),e.jsx("span",{children:"Solicitação criada"})]}),s.processed_at&&e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-gray-600",children:new Date(s.processed_at).toLocaleString("pt-BR")}),e.jsxs("span",{children:["Status alterado para ",j.label]})]})]})})]})]})]})})}function oe(s){return{aguardando_analise:{label:"Aguardando Análise",color:"bg-yellow-100 text-yellow-800 border-yellow-200",icon:L},pagamento_agendado:{label:"Pagamento Agendado",color:"bg-blue-100 text-blue-800 border-blue-200",icon:J},pagamento_efetuado:{label:"Pagamento Efetuado",color:"bg-green-100 text-green-800 border-green-200",icon:E},cancelado:{label:"Cancelado",color:"bg-gray-100 text-gray-800 border-gray-200",icon:I},reprovado:{label:"Reprovado",color:"bg-red-100 text-red-800 border-red-200",icon:S}}[s]}export{je as default};
