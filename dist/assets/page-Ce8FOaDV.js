import{r as v,n as q,a2 as ne,ao as ie,F as Z,j as e,C as b,a as P,d as F,e as oe,g as w,af as r,B as C,f as y,ak as Ce,p as de,m as me,aE as xe,aF as he,aG as ue,aH as ge,aI as je,aR as $,aX as pe,aJ as ve,aK as Ne,ag as T,E as k,H as O,I as E,J as I,K as c,D as W,ax as _e,P as le,v as ee,w as se,x as ae,ae as te,y as ye,az as fe,Z as Se,aj as De,U as Pe,aU as Ae,aN as ce,aV as Re}from"./index-D2dOrPZ8.js";import{T as V}from"./triangle-alert-Cjhkzg0C.js";import{M as be}from"./message-square-Bm6iE3sR.js";import{P as re}from"./progress-BnPXSgzQ.js";import{T as Fe}from"./trending-down-DG-mIJr0.js";import{S as we}from"./square-pen-Bi43ABVd.js";import{F as Te}from"./funnel-D8IEwOH8.js";const ke={elaborado:["em_negociacao","perdido"],em_negociacao:["aguardando_pagamento","perdido"],perdido:[],aguardando_pagamento:["ativo","inadimplente"],ativo:["concluido","cancelado","inadimplente"],inadimplente:["ativo","cancelado"],cancelado:[],concluido:[]},D={elaborado:{label:"Elaborado",color:"bg-blue-100 text-blue-800",icon:Z,description:"Proposta em elaboração"},em_negociacao:{label:"Em Negociação",color:"bg-yellow-100 text-yellow-800",icon:ie,description:"Negociando termos e condições"},perdido:{label:"Perdido",color:"bg-red-100 text-red-800",icon:V,description:"Projeto não foi fechado"},aguardando_pagamento:{label:"Aguardando Pagamento",color:"bg-orange-100 text-orange-800",icon:ne,description:"Aguardando confirmação de pagamento"},ativo:{label:"Ativo",color:"bg-green-100 text-green-800",icon:q,description:"Projeto em execução"},inadimplente:{label:"Inadimplente",color:"bg-red-100 text-red-800",icon:V,description:"Pagamento em atraso"},cancelado:{label:"Cancelado",color:"bg-gray-100 text-gray-800",icon:V,description:"Projeto cancelado"},concluido:{label:"Concluído",color:"bg-purple-100 text-purple-800",icon:q,description:"Projeto finalizado com sucesso"}},Y={elaborado:[],em_negociacao:["negotiation_start"],perdido:["loss_reason"],aguardando_pagamento:["payment_due_date"],ativo:["start_date"],inadimplente:["overdue_days"],cancelado:["cancellation_reason"],concluido:["completion_date"]};function Oe({project:j,onStatusChange:A,onAddHistory:R}){const[p,o]=v.useState(null),[d,n]=v.useState({}),[z,u]=v.useState(!1),[S,f]=v.useState(!1),N=j.status,g=ke[N]||[],_=D[N].icon,M=t=>{o(t),n({}),u(!0)},L=async()=>{if(p){f(!0);try{const i=Y[p].filter(B=>!d[B]);if(i.length>0){alert(`Campos obrigatórios não preenchidos: ${i.join(", ")}`);return}await A(j.id,p,d);const m={action:"status_change",description:`Status alterado de "${D[N].label}" para "${D[p].label}"`,user_id:"current-user-id",user_name:"Usuário Atual",user_type:"admin",timestamp:new Date().toISOString(),metadata:{from_status:N,to_status:p,...d}};await R(j.id,m),u(!1),o(null),n({})}catch(t){console.error("Erro ao alterar status:",t),alert("Erro ao alterar status do projeto")}finally{f(!1)}}},G=t=>{switch(t){case"negotiation_start":return e.jsxs("div",{children:[e.jsx(r,{htmlFor:t,children:"Data de Início da Negociação"}),e.jsx(T,{id:t,type:"date",value:d[t]||"",onChange:i=>n(m=>({...m,[t]:i.target.value})),required:!0})]},t);case"loss_reason":return e.jsxs("div",{children:[e.jsx(r,{htmlFor:t,children:"Motivo da Perda"}),e.jsxs(k,{value:d[t]||"",onValueChange:i=>n(m=>({...m,[t]:i})),children:[e.jsx(O,{children:e.jsx(E,{placeholder:"Selecione o motivo"})}),e.jsxs(I,{children:[e.jsx(c,{value:"price",children:"Preço muito alto"}),e.jsx(c,{value:"timeline",children:"Prazo inadequado"}),e.jsx(c,{value:"competitor",children:"Escolheu concorrente"}),e.jsx(c,{value:"budget",children:"Sem orçamento"}),e.jsx(c,{value:"scope",children:"Escopo não atendido"}),e.jsx(c,{value:"other",children:"Outros motivos"})]})]}),d[t]==="other"&&e.jsx($,{placeholder:"Descreva o motivo...",value:d.loss_reason_details||"",onChange:i=>n(m=>({...m,loss_reason_details:i.target.value})),className:"mt-2"})]},t);case"payment_due_date":return e.jsxs("div",{children:[e.jsx(r,{htmlFor:t,children:"Data de Vencimento do Pagamento"}),e.jsx(T,{id:t,type:"date",value:d[t]||"",onChange:i=>n(m=>({...m,[t]:i.target.value})),required:!0})]},t);case"start_date":return e.jsxs("div",{children:[e.jsx(r,{htmlFor:t,children:"Data de Início do Projeto"}),e.jsx(T,{id:t,type:"date",value:d[t]||"",onChange:i=>n(m=>({...m,[t]:i.target.value})),required:!0})]},t);case"overdue_days":return e.jsxs("div",{children:[e.jsx(r,{htmlFor:t,children:"Dias em Atraso"}),e.jsx(T,{id:t,type:"number",min:"1",value:d[t]||"",onChange:i=>n(m=>({...m,[t]:i.target.value})),required:!0})]},t);case"cancellation_reason":return e.jsxs("div",{children:[e.jsx(r,{htmlFor:t,children:"Motivo do Cancelamento"}),e.jsx($,{id:t,placeholder:"Descreva o motivo do cancelamento...",value:d[t]||"",onChange:i=>n(m=>({...m,[t]:i.target.value})),required:!0})]},t);case"completion_date":return e.jsxs("div",{children:[e.jsx(r,{htmlFor:t,children:"Data de Conclusão"}),e.jsx(T,{id:t,type:"date",value:d[t]||"",onChange:i=>n(m=>({...m,[t]:i.target.value})),required:!0})]},t);default:return null}};return e.jsxs(b,{children:[e.jsxs(P,{children:[e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"}),"Gestão de Status"]}),e.jsx(oe,{children:"Gerencie o fluxo de status do projeto premium"})]}),e.jsxs(w,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-700",children:"Status Atual"}),e.jsxs("div",{className:"mt-2",children:[e.jsxs(C,{className:`${D[N].color} text-sm px-3 py-1`,children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),D[N].label]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:D[N].description})]})]}),g.length>0&&e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-700",children:"Próximos Status Disponíveis"}),e.jsx("div",{className:"mt-2 grid grid-cols-1 sm:grid-cols-2 gap-3",children:g.map(t=>{const i=D[t].icon;return e.jsx(y,{variant:"outline",className:"justify-start h-auto p-4 bg-transparent",onClick:()=>M(t),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i,{className:"h-5 w-5"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:D[t].label}),e.jsx("div",{className:"text-xs text-gray-500",children:D[t].description})]}),e.jsx(Ce,{className:"h-4 w-4 ml-auto"})]})},t)})})]}),g.length===0&&e.jsxs("div",{className:"text-center py-6",children:[e.jsx(q,{className:"h-12 w-12 text-green-500 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Status Final"}),e.jsx("p",{className:"text-gray-600",children:"Este projeto atingiu um status final e não pode ser alterado."})]}),j.history&&j.history.length>0&&e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-700",children:"Histórico Recente"}),e.jsx("div",{className:"mt-2 space-y-2",children:j.history.slice(-3).map(t=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(be,{className:"h-4 w-4 text-gray-400 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:t.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-500",children:[e.jsx(de,{className:"h-3 w-3"}),e.jsx("span",{children:t.user_name}),e.jsx(me,{className:"h-3 w-3 ml-2"}),e.jsx("span",{children:new Date(t.timestamp).toLocaleString("pt-BR")})]})]})]},t.id))})]}),e.jsx(xe,{open:z,onOpenChange:u,children:e.jsxs(he,{className:"max-w-2xl",children:[e.jsxs(ue,{children:[e.jsxs(ge,{children:['Alterar Status para "',p?D[p].label:"",'"']}),e.jsxs(je,{children:["Esta ação irá alterar o status do projeto e será registrada no histórico.",p&&Y[p].length>0&&" Preencha os campos obrigatórios abaixo."]})]}),p&&Y[p].length>0&&e.jsx("div",{className:"space-y-4 py-4",children:Y[p].map(G)}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{children:[e.jsx(r,{htmlFor:"notes",children:"Observações (Opcional)"}),e.jsx($,{id:"notes",placeholder:"Adicione observações sobre esta alteração...",value:d.notes||"",onChange:t=>n(i=>({...i,notes:t.target.value}))})]})}),e.jsxs(pe,{children:[e.jsx(ve,{disabled:S,children:"Cancelar"}),e.jsx(Ne,{onClick:L,disabled:S,children:S?"Alterando...":"Confirmar Alteração"})]})]})})]})]})}const J={on_track:{label:"No Orçamento",color:"bg-green-100 text-green-800",icon:q},over_budget:{label:"Acima do Orçamento",color:"bg-red-100 text-red-800",icon:V},under_budget:{label:"Abaixo do Orçamento",color:"bg-blue-100 text-blue-800",icon:Fe}},X={on_time:{label:"No Prazo",color:"bg-green-100 text-green-800",icon:q},delayed:{label:"Atrasado",color:"bg-red-100 text-red-800",icon:V},ahead:{label:"Adiantado",color:"bg-blue-100 text-blue-800",icon:ye}};function Ee({project:j,onAddReport:A,onUpdateReport:R,onDeleteReport:p}){const[o,d]=v.useState(!1),[n,z]=v.useState(null),[u,S]=v.useState(null),[f,N]=v.useState(!1),[g,_]=v.useState({reporter_type:"commercial_admin",status_update:"",client_satisfaction:5,challenges:"",next_steps:"",completion_percentage:0,budget_status:"on_track",timeline_status:"on_time"}),M=j.reports||[],L=[...M].sort((a,l)=>new Date(l.report_date).getTime()-new Date(a.report_date).getTime()),G=async()=>{if(!g.status_update.trim()||!g.next_steps.trim()){alert("Por favor, preencha todos os campos obrigatórios");return}N(!0);try{const a={...g,reporter_id:g.reporter_type==="commercial_admin"?j.commercial_admin.id:j.partner_agency.id,report_date:new Date().toISOString().split("T")[0]};await A(j.id,a),_({reporter_type:"commercial_admin",status_update:"",client_satisfaction:5,challenges:"",next_steps:"",completion_percentage:0,budget_status:"on_track",timeline_status:"on_time"}),d(!1)}catch(a){console.error("Erro ao criar relatório:",a),alert("Erro ao criar relatório")}finally{N(!1)}},t=async a=>{N(!0);try{await p(j.id,a),S(null)}catch(l){console.error("Erro ao deletar relatório:",l),alert("Erro ao deletar relatório")}finally{N(!1)}},i=a=>new Date(a).toLocaleDateString("pt-BR"),m=a=>a.reporter_type==="commercial_admin"?j.commercial_admin.name:j.partner_agency.contact_person,B=a=>a.reporter_type==="commercial_admin"?"Admin Comercial":"Agência Partner",U=a=>Array.from({length:5},(l,x)=>e.jsx(De,{className:`h-4 w-4 ${x<a?"text-yellow-400 fill-current":"text-gray-300"}`},x)),s=(()=>{if(M.length===0)return"Primeiro relatório";const a=L[0],l=new Date(a.report_date),x=new Date(l);x.setDate(x.getDate()+7);const h=new Date,H=x<h;return{date:x.toLocaleDateString("pt-BR"),isOverdue:H,daysOverdue:H?Math.floor((h.getTime()-x.getTime())/(1e3*60*60*24)):0}})();return e.jsxs(b,{children:[e.jsx(P,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"}),"Relatórios do Projeto"]}),e.jsx(oe,{children:"Acompanhamento periódico do progresso e status do projeto"})]}),e.jsxs(W,{open:o,onOpenChange:d,children:[e.jsx(_e,{asChild:!0,children:e.jsxs(y,{children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Novo Relatório"]})}),e.jsxs(ee,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(se,{children:[e.jsx(ae,{children:"Criar Novo Relatório"}),e.jsx(te,{children:"Adicione um relatório de acompanhamento do projeto"})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"reporter-type",children:"Tipo de Relator"}),e.jsxs(k,{value:g.reporter_type,onValueChange:a=>_(l=>({...l,reporter_type:a})),children:[e.jsx(O,{children:e.jsx(E,{})}),e.jsxs(I,{children:[e.jsx(c,{value:"commercial_admin",children:"Admin Comercial"}),e.jsx(c,{value:"partner_agency",children:"Agência Partner"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"status-update",children:"Atualização de Status *"}),e.jsx($,{id:"status-update",placeholder:"Descreva o status atual do projeto...",value:g.status_update,onChange:a=>_(l=>({...l,status_update:a.target.value})),rows:3,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"client-satisfaction",children:"Satisfação do Cliente"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs(k,{value:g.client_satisfaction.toString(),onValueChange:a=>_(l=>({...l,client_satisfaction:Number.parseInt(a)})),children:[e.jsx(O,{children:e.jsx(E,{})}),e.jsxs(I,{children:[e.jsx(c,{value:"1",children:"1 - Muito Insatisfeito"}),e.jsx(c,{value:"2",children:"2 - Insatisfeito"}),e.jsx(c,{value:"3",children:"3 - Neutro"}),e.jsx(c,{value:"4",children:"4 - Satisfeito"}),e.jsx(c,{value:"5",children:"5 - Muito Satisfeito"})]})]}),e.jsx("div",{className:"flex",children:U(g.client_satisfaction)})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"completion",children:"Percentual de Conclusão"}),e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsx(T,{id:"completion",type:"number",min:"0",max:"100",value:g.completion_percentage,onChange:a=>_(l=>({...l,completion_percentage:Number.parseInt(a.target.value)||0}))}),e.jsx(re,{value:g.completion_percentage,className:"h-2"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"budget-status",children:"Status do Orçamento"}),e.jsxs(k,{value:g.budget_status,onValueChange:a=>_(l=>({...l,budget_status:a})),children:[e.jsx(O,{children:e.jsx(E,{})}),e.jsxs(I,{children:[e.jsx(c,{value:"on_track",children:"No Orçamento"}),e.jsx(c,{value:"over_budget",children:"Acima do Orçamento"}),e.jsx(c,{value:"under_budget",children:"Abaixo do Orçamento"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"timeline-status",children:"Status do Cronograma"}),e.jsxs(k,{value:g.timeline_status,onValueChange:a=>_(l=>({...l,timeline_status:a})),children:[e.jsx(O,{children:e.jsx(E,{})}),e.jsxs(I,{children:[e.jsx(c,{value:"on_time",children:"No Prazo"}),e.jsx(c,{value:"delayed",children:"Atrasado"}),e.jsx(c,{value:"ahead",children:"Adiantado"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"challenges",children:"Desafios e Obstáculos"}),e.jsx($,{id:"challenges",placeholder:"Descreva os principais desafios enfrentados...",value:g.challenges,onChange:a=>_(l=>({...l,challenges:a.target.value})),rows:2})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"next-steps",children:"Próximos Passos *"}),e.jsx($,{id:"next-steps",placeholder:"Descreva os próximos passos planejados...",value:g.next_steps,onChange:a=>_(l=>({...l,next_steps:a.target.value})),rows:2,required:!0})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(y,{variant:"outline",onClick:()=>d(!1),children:"Cancelar"}),e.jsx(y,{onClick:G,disabled:f,children:f?"Criando...":"Criar Relatório"})]})]})]})]})}),e.jsxs(w,{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ie,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900",children:"Próximo Relatório"})]}),typeof s=="string"?e.jsx("p",{className:"text-sm text-blue-700",children:s}):e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-blue-700",children:["Vencimento: ",s.date,s.isOverdue&&e.jsxs(C,{variant:"destructive",className:"ml-2",children:[s.daysOverdue," dias em atraso"]})]})})]}),L.length>0?e.jsx("div",{className:"space-y-4",children:L.map(a=>{const l=J[a.budget_status].icon,x=X[a.timeline_status].icon;return e.jsxs(b,{className:"border-l-4 border-l-blue-500",children:[e.jsx(P,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(de,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:m(a)}),e.jsx(C,{variant:"outline",className:"text-xs",children:B(a)})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{children:i(a.report_date)})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>z(a),children:e.jsx(fe,{className:"h-4 w-4"})}),e.jsx(y,{variant:"ghost",size:"sm",children:e.jsx(we,{className:"h-4 w-4"})}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>S(a.id),children:e.jsx(Se,{className:"h-4 w-4"})})]})]})}),e.jsx(w,{className:"pt-0",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-700",children:"Atualização de Status"}),e.jsx("p",{className:"text-sm text-gray-900 mt-1",children:a.status_update})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-700",children:"Satisfação"}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[U(a.client_satisfaction),e.jsxs("span",{className:"text-sm text-gray-600 ml-1",children:["(",a.client_satisfaction,"/5)"]})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-700",children:"Progresso"}),e.jsx("div",{className:"mt-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{value:a.completion_percentage,className:"h-2 flex-1"}),e.jsxs("span",{className:"text-sm font-medium",children:[a.completion_percentage,"%"]})]})})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-700",children:"Orçamento"}),e.jsx("div",{className:"mt-1",children:e.jsxs(C,{className:J[a.budget_status].color,children:[e.jsx(l,{className:"h-3 w-3 mr-1"}),J[a.budget_status].label]})})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-700",children:"Cronograma"}),e.jsx("div",{className:"mt-1",children:e.jsxs(C,{className:X[a.timeline_status].color,children:[e.jsx(x,{className:"h-3 w-3 mr-1"}),X[a.timeline_status].label]})})]})]}),(a.challenges||a.next_steps)&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.challenges&&e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-700",children:"Desafios"}),e.jsx("p",{className:"text-sm text-gray-900 mt-1",children:a.challenges})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-700",children:"Próximos Passos"}),e.jsx("p",{className:"text-sm text-gray-900 mt-1",children:a.next_steps})]})]})]})})]},a.id)})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Nenhum relatório encontrado"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Comece criando o primeiro relatório de acompanhamento do projeto"}),e.jsxs(y,{onClick:()=>d(!0),children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Criar Primeiro Relatório"]})]}),n&&e.jsx(W,{open:!!n,onOpenChange:()=>z(null),children:e.jsxs(ee,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(se,{children:[e.jsx(ae,{children:"Detalhes do Relatório"}),e.jsxs(te,{children:["Relatório de ",i(n.report_date)," por ",m(n)]})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-700",children:"Relator"}),e.jsxs("div",{className:"mt-1",children:[e.jsx("p",{className:"font-medium",children:m(n)}),e.jsx("p",{className:"text-sm text-gray-600",children:B(n)})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-700",children:"Data do Relatório"}),e.jsx("p",{className:"mt-1",children:i(n.report_date)})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-700",children:"Atualização de Status"}),e.jsx("p",{className:"mt-1 text-gray-900",children:n.status_update})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-700",children:"Satisfação do Cliente"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[U(n.client_satisfaction),e.jsxs("span",{className:"text-sm text-gray-600",children:["(",n.client_satisfaction,"/5)"]})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-700",children:"Progresso do Projeto"}),e.jsx("div",{className:"mt-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{value:n.completion_percentage,className:"h-3 flex-1"}),e.jsxs("span",{className:"font-medium",children:[n.completion_percentage,"%"]})]})})]})]}),n.challenges&&e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-700",children:"Desafios e Obstáculos"}),e.jsx("p",{className:"mt-1 text-gray-900",children:n.challenges})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-700",children:"Próximos Passos"}),e.jsx("p",{className:"mt-1 text-gray-900",children:n.next_steps})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-700",children:"Status do Orçamento"}),e.jsx("div",{className:"mt-1",children:e.jsx(C,{className:J[n.budget_status].color,children:J[n.budget_status].label})})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-700",children:"Status do Cronograma"}),e.jsx("div",{className:"mt-1",children:e.jsx(C,{className:X[n.timeline_status].color,children:X[n.timeline_status].label})})]})]})]})]})}),e.jsx(xe,{open:!!u,onOpenChange:()=>S(null),children:e.jsxs(he,{children:[e.jsxs(ue,{children:[e.jsx(ge,{children:"Confirmar Exclusão"}),e.jsx(je,{children:"Tem certeza que deseja excluir este relatório? Esta ação não pode ser desfeita."})]}),e.jsxs(pe,{children:[e.jsx(ve,{disabled:f,children:"Cancelar"}),e.jsx(Ne,{onClick:()=>u&&t(u),disabled:f,children:f?"Excluindo...":"Excluir"})]})]})})]})]})}const Ie={total_projects:24,active_projects:12,total_value:185e4,conversion_rate:68.5,average_project_value:77083,projects_by_status:{elaborado:3,em_negociacao:5,perdido:2,aguardando_pagamento:4,ativo:8,inadimplente:1,cancelado:1,concluido:0},top_performing_agencies:[],top_performing_admins:[]},Ve=[{id:"1",title:"Transformação Digital - TechCorp",description:"Projeto completo de transformação digital incluindo modernização de sistemas e processos",client:{id:"c1",name:"João Empresário",email:"joao@techcorp.com",phone:"+55 11 98888-0001",company:"TechCorp Ltda",segment:"Tecnologia",created_from_lead:!0,lead_id:"lead-001",potential_value:15e4,contact_preference:"email"},status:"em_negociacao",value:15e4,created_at:"2024-01-15T10:00:00Z",updated_at:"2024-01-20T14:30:00Z",commercial_admin:{id:"ca1",name:"Carlos Mendes",email:"carlos.mendes@allka.com",phone:"+55 11 99999-0001",active_projects:5,conversion_rate:75.5},partner_agency:{id:"pa1",name:"Digital Solutions Agency",partner_level:"premium",contact_person:"Ana Silva",email:"ana@digitalsolutions.com",phone:"+55 11 97777-0001",active_projects:8,satisfaction_rating:4.8},proposal_date:"2024-01-15",negotiation_start:"2024-01-18",reports:[],history:[],conversion_probability:75,satisfaction_score:4.5,churn_risk:"low"},{id:"2",title:"E-commerce Premium - StartupXYZ",description:"Desenvolvimento de plataforma e-commerce com recursos avançados",client:{id:"c2",name:"Maria Gestora",email:"maria@startupxyz.com",phone:"+55 11 98888-0002",company:"StartupXYZ",segment:"E-commerce",created_from_lead:!0,potential_value:85e3,contact_preference:"whatsapp"},status:"ativo",value:85e3,created_at:"2024-01-10T09:00:00Z",updated_at:"2024-01-22T16:45:00Z",commercial_admin:{id:"ca2",name:"Ana Paula Silva",email:"ana.silva@allka.com",phone:"+55 11 99999-0002",active_projects:3,conversion_rate:82.3},partner_agency:{id:"pa2",name:"Creative Partners",partner_level:"elite",contact_person:"Roberto Costa",email:"roberto@creativepartners.com",phone:"+55 11 97777-0002",active_projects:12,satisfaction_rating:4.9},proposal_date:"2024-01-10",start_date:"2024-01-20",reports:[],history:[],conversion_probability:90,satisfaction_score:4.7,churn_risk:"low"}],Q={elaborado:{label:"Elaborado",color:"bg-blue-100 text-blue-800",icon:Z},em_negociacao:{label:"Em Negociação",color:"bg-yellow-100 text-yellow-800",icon:ie},perdido:{label:"Perdido",color:"bg-red-100 text-red-800",icon:V},aguardando_pagamento:{label:"Aguardando Pagamento",color:"bg-orange-100 text-orange-800",icon:ne},ativo:{label:"Ativo",color:"bg-green-100 text-green-800",icon:q},inadimplente:{label:"Inadimplente",color:"bg-red-100 text-red-800",icon:V},cancelado:{label:"Cancelado",color:"bg-gray-100 text-gray-800",icon:V},concluido:{label:"Concluído",color:"bg-purple-100 text-purple-800",icon:q}};function $e(){const[j,A]=v.useState(Ve),[R,p]=v.useState(Ie),[o,d]=v.useState({status:"all",commercial_admin:"all",partner_agency:"all",value_range:{min:0,max:1e6},date_range:{start:"",end:""},churn_risk:"all"}),[n,z]=v.useState(""),[u,S]=v.useState(null),[f,N]=v.useState(!1),g=async(s,a,l)=>{console.log("[v0] Changing project status:",{projectId:s,newStatus:a,data:l}),A(x=>x.map(h=>h.id===s?{...h,status:a,...l,updated_at:new Date().toISOString()}:h))},_=async(s,a)=>{console.log("[v0] Adding project history:",{projectId:s,historyEntry:a});const l={...a,id:`history-${Date.now()}`,project_id:s};A(x=>x.map(h=>h.id===s?{...h,history:[...h.history||[],l]}:h))},M=async(s,a)=>{console.log("[v0] Adding project report:",{projectId:s,reportData:a});const l={...a,id:`report-${Date.now()}`,project_id:s};A(x=>x.map(h=>h.id===s?{...h,reports:[...h.reports||[],l],last_report_date:a.report_date,updated_at:new Date().toISOString()}:h))},L=async(s,a,l)=>{console.log("[v0] Updating project report:",{projectId:s,reportId:a,reportData:l}),A(x=>x.map(h=>h.id===s?{...h,reports:(h.reports||[]).map(H=>H.id===a?{...H,...l}:H),updated_at:new Date().toISOString()}:h))},G=async(s,a)=>{console.log("[v0] Deleting project report:",{projectId:s,reportId:a}),A(l=>l.map(x=>x.id===s?{...x,reports:(x.reports||[]).filter(h=>h.id!==a),updated_at:new Date().toISOString()}:x))},t=j.filter(s=>!(n&&!s.title.toLowerCase().includes(n.toLowerCase())&&!s.client.name.toLowerCase().includes(n.toLowerCase())||o.status!=="all"&&s.status!==o.status||o.commercial_admin!=="all"&&s.commercial_admin.id!==o.commercial_admin||o.partner_agency!=="all"&&s.partner_agency.id!==o.partner_agency||s.value<o.value_range.min||s.value>o.value_range.max||o.churn_risk!=="all"&&s.churn_risk!==o.churn_risk)),i=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),m=s=>new Date(s).toLocaleDateString("pt-BR"),B=s=>{switch(s){case"email":return ce;case"phone":return Re;case"whatsapp":return be;default:return ce}},U=()=>{d({status:"all",commercial_admin:"all",partner_agency:"all",value_range:{min:0,max:1e6},date_range:{start:"",end:""},churn_risk:"all"}),z("")},K=()=>o.status!=="all"||o.commercial_admin!=="all"||o.partner_agency!=="all"||o.value_range.min>0||o.value_range.max<1e6||o.date_range.start!==""||o.date_range.end!==""||o.churn_risk!=="all"||n!=="";return e.jsxs("div",{className:"space-y-6 my-0 px-1 py-1 mx-3.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Projetos Premium"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gestão completa do funil de projetos de alto valor"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(y,{onClick:()=>N(!f),variant:"outline",children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"Filtros",K()&&e.jsx(C,{variant:"secondary",className:"ml-2 h-5 w-5 p-0 flex items-center justify-center",children:"!"})]}),e.jsxs(W,{children:[e.jsx(_e,{asChild:!0,children:e.jsxs(y,{children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Novo Projeto"]})}),e.jsxs(ee,{className:"max-w-2xl",children:[e.jsxs(se,{children:[e.jsx(ae,{children:"Criar Novo Projeto Premium"}),e.jsx(te,{children:"Converta um lead em projeto premium ou crie um novo projeto do zero"})]}),e.jsx("div",{className:"space-y-4",children:e.jsx("p",{className:"text-sm text-gray-500",children:"Formulário de criação será implementado"})})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(b,{children:[e.jsxs(P,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(F,{className:"text-sm font-medium",children:"Total de Projetos"}),e.jsx(Z,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(w,{children:[e.jsx("div",{className:"text-2xl font-bold",children:R.total_projects}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[R.active_projects," ativos"]})]})]}),e.jsxs(b,{children:[e.jsxs(P,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(F,{className:"text-sm font-medium",children:"Valor Total"}),e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(w,{children:[e.jsx("div",{className:"text-2xl font-bold",children:i(R.total_value)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Média: ",i(R.average_project_value)]})]})]}),e.jsxs(b,{children:[e.jsxs(P,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(F,{className:"text-sm font-medium",children:"Taxa de Conversão"}),e.jsx(ye,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(w,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[R.conversion_rate,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Últimos 30 dias"})]})]}),e.jsxs(b,{children:[e.jsxs(P,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(F,{className:"text-sm font-medium",children:"Projetos Ativos"}),e.jsx(Pe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(w,{children:[e.jsx("div",{className:"text-2xl font-bold",children:R.active_projects}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Em andamento"})]})]})]}),f&&e.jsxs(b,{children:[e.jsx(P,{children:e.jsx(F,{className:"text-lg",children:"Filtros Avançados"})}),e.jsxs(w,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"status",children:"Status"}),e.jsxs(k,{value:o.status,onValueChange:s=>d(a=>({...a,status:s})),children:[e.jsx(O,{children:e.jsx(E,{placeholder:"Todos os status"})}),e.jsxs(I,{children:[e.jsx(c,{value:"all",children:"Todos os status"}),Object.entries(Q).map(([s,a])=>e.jsx(c,{value:s,children:a.label},s))]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"admin",children:"Admin Comercial"}),e.jsxs(k,{value:o.commercial_admin,onValueChange:s=>d(a=>({...a,commercial_admin:s})),children:[e.jsx(O,{children:e.jsx(E,{placeholder:"Todos os admins"})}),e.jsxs(I,{children:[e.jsx(c,{value:"all",children:"Todos os admins"}),Array.from(new Set(j.map(s=>s.commercial_admin))).map(s=>e.jsx(c,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"agency",children:"Agência Partner"}),e.jsxs(k,{value:o.partner_agency,onValueChange:s=>d(a=>({...a,partner_agency:s})),children:[e.jsx(O,{children:e.jsx(E,{placeholder:"Todas as agências"})}),e.jsxs(I,{children:[e.jsx(c,{value:"all",children:"Todas as agências"}),Array.from(new Set(j.map(s=>s.partner_agency))).map(s=>e.jsx(c,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"risk",children:"Risco de Churn"}),e.jsxs(k,{value:o.churn_risk,onValueChange:s=>d(a=>({...a,churn_risk:s})),children:[e.jsx(O,{children:e.jsx(E,{placeholder:"Todos os riscos"})}),e.jsxs(I,{children:[e.jsx(c,{value:"all",children:"Todos os riscos"}),e.jsx(c,{value:"low",children:"Baixo"}),e.jsx(c,{value:"medium",children:"Médio"}),e.jsx(c,{value:"high",children:"Alto"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"min-value",children:"Valor Mínimo"}),e.jsx(T,{id:"min-value",type:"number",value:o.value_range.min,onChange:s=>d(a=>({...a,value_range:{...a.value_range,min:Number(s.target.value)}})),placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"max-value",children:"Valor Máximo"}),e.jsx(T,{id:"max-value",type:"number",value:o.value_range.max,onChange:s=>d(a=>({...a,value_range:{...a.value_range,max:Number(s.target.value)}})),placeholder:"1000000"})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(y,{variant:"outline",onClick:U,children:"Limpar Filtros"})})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(T,{placeholder:"Buscar por projeto ou cliente...",value:n,onChange:s=>z(s.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"grid gap-6",children:t.map(s=>{const a=Q[s.status].icon,l=B(s.client.contact_preference);return e.jsxs(b,{className:"hover:shadow-md transition-shadow",children:[e.jsx(P,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(F,{className:"text-xl",children:s.title}),e.jsxs(C,{className:Q[s.status].color,children:[e.jsx(a,{className:"h-3 w-3 mr-1"}),Q[s.status].label]}),s.churn_risk==="high"&&e.jsxs(C,{variant:"destructive",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),"Alto Risco"]})]}),e.jsx(oe,{className:"text-base",children:s.description})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:i(s.value)}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Prob: ",s.conversion_probability,"%"]})]})]})}),e.jsxs(w,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-2",children:"Cliente"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"font-medium",children:s.client.name})]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.client.company}),e.jsx("p",{className:"text-xs text-gray-500",children:s.client.segment})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-2",children:"Admin Comercial"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:s.commercial_admin.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.commercial_admin.active_projects," projetos ativos"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Taxa conversão: ",s.commercial_admin.conversion_rate,"%"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-2",children:"Agência Partner"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.partner_agency.name}),e.jsx(C,{variant:"outline",className:"text-xs",children:s.partner_agency.partner_level})]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.partner_agency.contact_person}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Satisfação: ",s.partner_agency.satisfaction_rating,"/5"]})]})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-gray-500",children:["Proposta: ",m(s.proposal_date)]}),s.negotiation_start&&e.jsxs("span",{className:"text-gray-500",children:["Negociação: ",m(s.negotiation_start)]}),s.start_date&&e.jsxs("span",{className:"text-gray-500",children:["Início: ",m(s.start_date)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>S(s),children:[e.jsx(fe,{className:"h-4 w-4 mr-1"}),"Ver Detalhes"]}),e.jsxs(y,{variant:"outline",size:"sm",children:[e.jsx(we,{className:"h-4 w-4 mr-1"}),"Editar"]})]})]})})]})]},s.id)})}),t.length===0&&e.jsx(b,{children:e.jsxs(w,{className:"text-center py-12",children:[e.jsx(Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Nenhum projeto encontrado"}),e.jsx("p",{className:"text-gray-600 mb-4",children:K()?"Tente ajustar os filtros para encontrar projetos":"Comece criando seu primeiro projeto premium"}),K()&&e.jsx(y,{variant:"outline",onClick:U,children:"Limpar Filtros"})]})}),u&&e.jsx(W,{open:!!u,onOpenChange:()=>S(null),children:e.jsxs(ee,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(se,{children:[e.jsx(ae,{children:u.title}),e.jsx(te,{children:"Detalhes completos do projeto premium"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Oe,{project:u,onStatusChange:g,onAddHistory:_}),e.jsxs(b,{children:[e.jsx(P,{children:e.jsx(F,{children:"Informações do Projeto"})}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-700",children:"Cliente"}),e.jsxs("div",{className:"mt-1",children:[e.jsx("p",{className:"font-medium",children:u.client.name}),e.jsx("p",{className:"text-sm text-gray-600",children:u.client.company}),e.jsx("p",{className:"text-sm text-gray-500",children:u.client.email})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-700",children:"Valor do Projeto"}),e.jsxs("div",{className:"mt-1",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:i(u.value)}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Probabilidade: ",u.conversion_probability,"%"]})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-700",children:"Admin Comercial"}),e.jsxs("div",{className:"mt-1",children:[e.jsx("p",{className:"font-medium",children:u.commercial_admin.name}),e.jsx("p",{className:"text-sm text-gray-600",children:u.commercial_admin.email})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-gray-700",children:"Agência Partner"}),e.jsxs("div",{className:"mt-1",children:[e.jsx("p",{className:"font-medium",children:u.partner_agency.name}),e.jsx("p",{className:"text-sm text-gray-600",children:u.partner_agency.contact_person})]})]})]})})]})]}),e.jsx(Ee,{project:u,onAddReport:M,onUpdateReport:L,onDeleteReport:G})]})]})})]})}export{$e as default};
