import{r as h,j as e,D as G,v as W,w as J,x as K,af as _,ag as E,aR as Ne,E as V,H as q,I as H,J as B,K as n,f as m,B as g,a1 as L,bh as fe,P as O,ai as _e,aL as ye,p as we,m as xe,n as X,an as be,ao as Ce,aw as Se,C as T,a as M,d as A,g as k,b3 as $,y as Te,T as Me,h as Ae,i as U,k as z,e as Q,aU as ke,aq as Y,ar as ee,as as se,av as P,Z as ae,aN as te,aW as le,a7 as I}from"./index-D2dOrPZ8.js";import{T as ie,a as ne,b as F,c as v,d as re,e as p}from"./table-DSYZvwhV.js";import{V as De}from"./video-BSGHFI8a.js";import{I as Ee}from"./image-C6z-v_3M.js";import{M as he}from"./message-square-Bm6iE3sR.js";import{C as Re}from"./circle-x-D0uMI9ez.js";import{P as ce}from"./play-CxVld3XJ.js";import{E as de}from"./ellipsis-C1yMrSu8.js";import{S as oe}from"./square-pen-Bi43ABVd.js";import{P as Pe}from"./pause-6mNLy7Cs.js";function Ie({open:j,onOpenChange:u,message:r,onSave:y}){const[d,o]=h.useState({title:r?.title||"",content:r?.content||"",type:r?.type||"info",channels:r?.channels||[],media_urls:r?.media_urls||[],variables:r?.variables||[]}),[t,b]=h.useState(""),N=()=>{y(d),u(!1)},C=()=>{t&&!d.variables.includes(t)&&(o(l=>({...l,variables:[...l.variables,t]})),b(""))},D=l=>{o(c=>({...c,variables:c.variables.filter(w=>w!==l)}))},R=l=>{o(c=>({...c,channels:c.channels.includes(l)?c.channels.filter(w=>w!==l):[...c.channels,l]}))};return e.jsx(G,{open:j,onOpenChange:u,children:e.jsxs(W,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(J,{children:e.jsx(K,{children:r?"Editar Mensagem":"Nova Mensagem"})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"title",children:"Título"}),e.jsx(E,{id:"title",value:d.title,onChange:l=>o(c=>({...c,title:l.target.value})),placeholder:"Título da mensagem"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"content",children:"Conteúdo"}),e.jsx(Ne,{id:"content",value:d.content,onChange:l=>o(c=>({...c,content:l.target.value})),placeholder:"Conteúdo da mensagem...",rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Tipo"}),e.jsxs(V,{value:d.type,onValueChange:l=>o(c=>({...c,type:l})),children:[e.jsx(q,{children:e.jsx(H,{})}),e.jsxs(B,{children:[e.jsx(n,{value:"info",children:"Informativo"}),e.jsx(n,{value:"warning",children:"Aviso"}),e.jsx(n,{value:"success",children:"Sucesso"}),e.jsx(n,{value:"error",children:"Erro"}),e.jsx(n,{value:"marketing",children:"Marketing"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Canais de Envio"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["email","whatsapp","in_app","push"].map(l=>e.jsxs(m,{type:"button",variant:d.channels.includes(l)?"default":"outline",size:"sm",onClick:()=>R(l),children:[l==="email"&&"E-mail",l==="whatsapp"&&"WhatsApp",l==="in_app"&&"In-App",l==="push"&&"Push"]},l))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Variáveis Dinâmicas"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{value:t,onChange:l=>b(l.target.value),placeholder:"Ex: {{nome_usuario}}",onKeyPress:l=>l.key==="Enter"&&C()}),e.jsx(m,{type:"button",onClick:C,children:"Adicionar"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d.variables.map(l=>e.jsxs(g,{variant:"secondary",className:"flex items-center gap-1",children:[l,e.jsx(L,{className:"h-3 w-3 cursor-pointer",onClick:()=>D(l)})]},l))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Mídia"}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(fe,{className:"mx-auto h-8 w-8 text-gray-400"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Arraste arquivos aqui ou clique para selecionar"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Suporte para imagens e vídeos"})]})}),d.media_urls.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-2",children:d.media_urls.map((l,c)=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"aspect-video bg-gray-100 rounded flex items-center justify-center",children:l.includes("video")?e.jsx(De,{className:"h-8 w-8 text-gray-400"}):e.jsx(Ee,{className:"h-8 w-8 text-gray-400"})}),e.jsx(m,{size:"sm",variant:"destructive",className:"absolute top-1 right-1 h-6 w-6 p-0",onClick:()=>{o(w=>({...w,media_urls:w.media_urls.filter((a,i)=>i!==c)}))},children:e.jsx(L,{className:"h-3 w-3"})})]},c))})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(m,{variant:"outline",onClick:()=>u(!1),children:"Cancelar"}),e.jsx(m,{onClick:N,children:"Salvar"})]})]})})}function Ve({open:j,onOpenChange:u,rule:r,onSave:y}){const[d,o]=h.useState({name:r?.name||"",trigger_event:r?.trigger_event||"",conditions:r?.conditions||{},target_audience:r?.target_audience||{},delay_minutes:r?.delay_minutes||0,is_active:r?.is_active??!0}),[t,b]=h.useState({field:"",operator:"",value:""}),[N,C]=h.useState({type:"",value:""}),D=()=>{y(d),u(!1)},R=()=>{t.field&&t.operator&&t.value&&(o(a=>({...a,conditions:{...a.conditions,[t.field]:{operator:t.operator,value:t.value}}})),b({field:"",operator:"",value:""}))},l=a=>{o(i=>{const S={...i.conditions};return delete S[a],{...i,conditions:S}})},c=()=>{N.type&&N.value&&(o(a=>({...a,target_audience:{...a.target_audience,[N.type]:N.value}})),C({type:"",value:""}))},w=a=>{o(i=>{const S={...i.target_audience};return delete S[a],{...i,target_audience:S}})};return e.jsx(G,{open:j,onOpenChange:u,children:e.jsxs(W,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(J,{children:e.jsx(K,{children:r?"Editar Regra":"Nova Regra de Disparo"})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"name",children:"Nome da Regra"}),e.jsx(E,{id:"name",value:d.name,onChange:a=>o(i=>({...i,name:a.target.value})),placeholder:"Nome identificador da regra"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Evento Gatilho"}),e.jsxs(V,{value:d.trigger_event,onValueChange:a=>o(i=>({...i,trigger_event:a})),children:[e.jsx(q,{children:e.jsx(H,{placeholder:"Selecione o evento"})}),e.jsxs(B,{children:[e.jsx(n,{value:"user_registration",children:"Cadastro de Usuário"}),e.jsx(n,{value:"project_created",children:"Projeto Criado"}),e.jsx(n,{value:"project_completed",children:"Projeto Concluído"}),e.jsx(n,{value:"payment_overdue",children:"Pagamento Atrasado"}),e.jsx(n,{value:"task_approved",children:"Tarefa Aprovada"}),e.jsx(n,{value:"nomade_qualified",children:"Nômade Qualificado"}),e.jsx(n,{value:"agency_upgraded",children:"Agência Promovida"}),e.jsx(n,{value:"course_completed",children:"Curso Concluído"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Condições"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(V,{value:t.field,onValueChange:a=>b(i=>({...i,field:a})),children:[e.jsx(q,{className:"flex-1",children:e.jsx(H,{placeholder:"Campo"})}),e.jsxs(B,{children:[e.jsx(n,{value:"account_type",children:"Tipo de Conta"}),e.jsx(n,{value:"account_level",children:"Nível da Conta"}),e.jsx(n,{value:"project_status",children:"Status do Projeto"}),e.jsx(n,{value:"days_since",children:"Dias Desde"}),e.jsx(n,{value:"project_value",children:"Valor do Projeto"})]})]}),e.jsxs(V,{value:t.operator,onValueChange:a=>b(i=>({...i,operator:a})),children:[e.jsx(q,{className:"flex-1",children:e.jsx(H,{placeholder:"Operador"})}),e.jsxs(B,{children:[e.jsx(n,{value:"equals",children:"Igual a"}),e.jsx(n,{value:"not_equals",children:"Diferente de"}),e.jsx(n,{value:"greater_than",children:"Maior que"}),e.jsx(n,{value:"less_than",children:"Menor que"}),e.jsx(n,{value:"contains",children:"Contém"})]})]}),e.jsx(E,{className:"flex-1",value:t.value,onChange:a=>b(i=>({...i,value:a.target.value})),placeholder:"Valor"}),e.jsx(m,{type:"button",onClick:R,children:e.jsx(O,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(d.conditions).map(([a,i])=>e.jsxs(g,{variant:"secondary",className:"flex items-center gap-1",children:[a," ",i.operator," ",i.value,e.jsx(L,{className:"h-3 w-3 cursor-pointer",onClick:()=>l(a)})]},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Público-Alvo"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(V,{value:N.type,onValueChange:a=>C(i=>({...i,type:a})),children:[e.jsx(q,{className:"flex-1",children:e.jsx(H,{placeholder:"Tipo"})}),e.jsxs(B,{children:[e.jsx(n,{value:"account_type",children:"Tipo de Conta"}),e.jsx(n,{value:"account_level",children:"Nível"}),e.jsx(n,{value:"location",children:"Localização"}),e.jsx(n,{value:"segment",children:"Segmento"})]})]}),e.jsx(E,{className:"flex-1",value:N.value,onChange:a=>C(i=>({...i,value:a.target.value})),placeholder:"Valor"}),e.jsx(m,{type:"button",onClick:c,children:e.jsx(O,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(d.target_audience).map(([a,i])=>e.jsxs(g,{variant:"outline",className:"flex items-center gap-1",children:[a,": ",i,e.jsx(L,{className:"h-3 w-3 cursor-pointer",onClick:()=>w(a)})]},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"delay",children:"Atraso (minutos)"}),e.jsx(E,{id:"delay",type:"number",value:d.delay_minutes,onChange:a=>o(i=>({...i,delay_minutes:Number.parseInt(a.target.value)||0})),placeholder:"0"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_e,{id:"active",checked:d.is_active,onCheckedChange:a=>o(i=>({...i,is_active:a}))}),e.jsx(_,{htmlFor:"active",children:"Regra Ativa"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(m,{variant:"outline",onClick:()=>u(!1),children:"Cancelar"}),e.jsx(m,{onClick:D,children:"Salvar"})]})]})})}function qe({open:j,onOpenChange:u,history:r=[]}){const y=t=>{switch(t){case"sent":return e.jsx(X,{className:"h-4 w-4 text-green-500"});case"failed":return e.jsx(Re,{className:"h-4 w-4 text-red-500"});case"pending":return e.jsx(Se,{className:"h-4 w-4 text-yellow-500"});default:return e.jsx(Ce,{className:"h-4 w-4 text-gray-500"})}},d=t=>{switch(t){case"sent":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},o=t=>new Date(t).toLocaleString("pt-BR");return e.jsx(G,{open:j,onOpenChange:u,children:e.jsxs(W,{className:"max-w-4xl max-h-[90vh]",children:[e.jsx(J,{children:e.jsx(K,{children:"Histórico de Notificações"})}),e.jsx(ye,{className:"h-[600px] pr-4",children:e.jsx("div",{className:"space-y-4",children:r.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(he,{className:"mx-auto h-12 w-12 mb-4 opacity-50"}),e.jsx("p",{children:"Nenhuma notificação encontrada"})]}):r.map(t=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"font-medium",children:t.message_title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(we,{className:"h-3 w-3"}),t.recipient_name||t.recipient_email]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"h-3 w-3"}),o(t.sent_at)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:d(t.status),children:e.jsxs("div",{className:"flex items-center gap-1",children:[y(t.status),t.status==="sent"&&"Enviado",t.status==="failed"&&"Falhou",t.status==="pending"&&"Pendente"]})}),e.jsx(g,{variant:"outline",children:t.channel})]})]}),e.jsx("div",{className:"text-sm text-gray-700",children:t.message_content}),t.error_message&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded p-2",children:e.jsxs("p",{className:"text-sm text-red-700",children:[e.jsx("strong",{children:"Erro:"})," ",t.error_message]})}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("div",{children:["Regra: ",t.rule_name||"Manual"]}),t.opened_at&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"h-3 w-3"}),"Aberto em ",o(t.opened_at)]})]}),e.jsx(be,{})]},t.id))})}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(m,{variant:"outline",onClick:()=>u(!1),children:"Fechar"})})]})})}function Je(){const[j,u]=h.useState([]),[r,y]=h.useState([]),[d,o]=h.useState([]),[t,b]=h.useState(""),[N,C]=h.useState(null),[D,R]=h.useState(null),[l,c]=h.useState(!1),[w,a]=h.useState(!1),[i,S]=h.useState(!1),[me,je]=h.useState(!0),ue=[{id:"msg-1",name:"Boas-vindas Agência",title:"Bem-vindo à Allka!",content:"Olá {user_name}, seja bem-vindo à plataforma Allka...",message_type:"html",has_images:!0,has_videos:!1,is_active:!0,created_at:"2024-01-15T10:00:00Z",updated_at:"2024-01-20T14:30:00Z",created_by:"admin-1",attachments:[]},{id:"msg-2",name:"Projeto Atrasado",title:"Atenção: Projeto com atraso",content:"Seu projeto {project_name} está com {delay_days} dias de atraso...",message_type:"text",has_images:!1,has_videos:!1,is_active:!0,created_at:"2024-01-18T09:00:00Z",updated_at:"2024-01-18T09:00:00Z",created_by:"admin-2",attachments:[]}],ve=[{id:"rule-1",message_id:"msg-1",name:"Boas-vindas Automático",is_active:!0,target_account_types:["agency"],target_account_levels:[],target_project_status:[],target_custom_filters:{},channels:[{type:"email",is_enabled:!0,config:{}},{type:"in_app_popup",is_enabled:!0,config:{}}],trigger_type:"event",trigger_config:{event:"account_created"},created_at:"2024-01-15T10:00:00Z",updated_at:"2024-01-15T10:00:00Z",created_by:"admin-1"},{id:"rule-2",message_id:"msg-2",name:"Alerta Projeto Atrasado",is_active:!0,target_account_types:["agency"],target_account_levels:[],target_project_status:["em_andamento"],target_custom_filters:{},channels:[{type:"email",is_enabled:!0,config:{}},{type:"whatsapp",is_enabled:!0,config:{}}],trigger_type:"conditional",trigger_config:{condition:"project_overdue",days:3},created_at:"2024-01-18T09:00:00Z",updated_at:"2024-01-18T09:00:00Z",created_by:"admin-2"}],pe=[{id:"hist-1",rule_id:"rule-1",message_id:"msg-1",recipient_id:"agency-123",recipient_name:"João Silva",recipient_email:"joao@empresa.com",channel:"email",status:"delivered",sent_at:"2024-01-20T10:30:00Z",delivered_at:"2024-01-20T10:31:00Z",opened_at:"2024-01-20T11:15:00Z",metadata:{}}];h.useEffect(()=>{setTimeout(()=>{u(ue),y(ve),o(pe),je(!1)},1e3)},[]);const ge=s=>{const x={email:te,whatsapp:le,in_app_popup:I,in_app_banner:I,push:I}[s]||I;return e.jsx(x,{className:"h-4 w-4"})};return me?e.jsx("div",{className:"container mx-auto p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-32 bg-gray-200 rounded"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Módulo de Notificações"}),e.jsx("p",{className:"text-muted-foreground",children:"Central de automação de comunicação da Allka"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(m,{variant:"outline",onClick:()=>S(!0),children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Histórico"]}),e.jsxs(m,{onClick:()=>c(!0),children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Nova Mensagem"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(T,{children:[e.jsxs(M,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(A,{className:"text-sm font-medium",children:"Mensagens Ativas"}),e.jsx(he,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:j.filter(s=>s.is_active).length}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[j.length," total"]})]})]}),e.jsxs(T,{children:[e.jsxs(M,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(A,{className:"text-sm font-medium",children:"Regras Ativas"}),e.jsx(ce,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r.filter(s=>s.is_active).length}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.length," total"]})]})]}),e.jsxs(T,{children:[e.jsxs(M,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(A,{className:"text-sm font-medium",children:"Enviadas Hoje"}),e.jsx($,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"247"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+18% vs ontem"})]})]}),e.jsxs(T,{children:[e.jsxs(M,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(A,{className:"text-sm font-medium",children:"Taxa de Abertura"}),e.jsx(Te,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"68%"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+5% vs semana passada"})]})]})]}),e.jsxs(Me,{defaultValue:"messages",className:"space-y-4",children:[e.jsxs(Ae,{children:[e.jsx(U,{value:"messages",children:"Mensagens"}),e.jsx(U,{value:"rules",children:"Regras de Disparo"}),e.jsx(U,{value:"analytics",children:"Análises"})]}),e.jsx(z,{value:"messages",className:"space-y-4",children:e.jsxs(T,{children:[e.jsxs(M,{children:[e.jsx(A,{children:"Mensagens Cadastradas"}),e.jsx(Q,{children:"Gerencie todas as mensagens disponíveis para envio"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"flex items-center space-x-2 mb-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ke,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(E,{placeholder:"Buscar mensagens...",value:t,onChange:s=>b(s.target.value),className:"pl-8"})]})}),e.jsxs(ie,{children:[e.jsx(ne,{children:e.jsxs(F,{children:[e.jsx(v,{children:"Nome"}),e.jsx(v,{children:"Título"}),e.jsx(v,{children:"Tipo"}),e.jsx(v,{children:"Mídia"}),e.jsx(v,{children:"Status"}),e.jsx(v,{children:"Criado"}),e.jsx(v,{className:"text-right",children:"Ações"})]})}),e.jsx(re,{children:j.map(s=>e.jsxs(F,{children:[e.jsx(p,{className:"font-medium",children:s.name}),e.jsx(p,{children:s.title}),e.jsx(p,{children:e.jsx(g,{variant:"outline",children:s.message_type.toUpperCase()})}),e.jsx(p,{children:e.jsxs("div",{className:"flex space-x-1",children:[s.has_images&&e.jsx(g,{variant:"secondary",className:"text-xs",children:"IMG"}),s.has_videos&&e.jsx(g,{variant:"secondary",className:"text-xs",children:"VID"}),!s.has_images&&!s.has_videos&&e.jsx("span",{className:"text-muted-foreground text-sm",children:"-"})]})}),e.jsx(p,{children:e.jsx(g,{variant:s.is_active?"default":"secondary",children:s.is_active?"Ativo":"Inativo"})}),e.jsx(p,{children:new Date(s.created_at).toLocaleDateString("pt-BR")}),e.jsx(p,{className:"text-right",children:e.jsxs(Y,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(m,{variant:"ghost",className:"h-8 w-8 p-0",children:e.jsx(de,{className:"h-4 w-4"})})}),e.jsxs(se,{align:"end",children:[e.jsxs(P,{onClick:()=>{C(s),c(!0)},children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),"Editar"]}),e.jsxs(P,{children:[e.jsx($,{className:"mr-2 h-4 w-4"}),"Enviar Teste"]}),e.jsxs(P,{className:"text-red-600",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Excluir"]})]})]})})]},s.id))})]})]})]})}),e.jsx(z,{value:"rules",className:"space-y-4",children:e.jsxs(T,{children:[e.jsx(M,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(A,{children:"Regras de Disparo"}),e.jsx(Q,{children:"Configure quando e para quem as mensagens devem ser enviadas"})]}),e.jsxs(m,{onClick:()=>a(!0),children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Nova Regra"]})]})}),e.jsx(k,{children:e.jsxs(ie,{children:[e.jsx(ne,{children:e.jsxs(F,{children:[e.jsx(v,{children:"Nome"}),e.jsx(v,{children:"Mensagem"}),e.jsx(v,{children:"Público-Alvo"}),e.jsx(v,{children:"Canais"}),e.jsx(v,{children:"Gatilho"}),e.jsx(v,{children:"Status"}),e.jsx(v,{className:"text-right",children:"Ações"})]})}),e.jsx(re,{children:r.map(s=>{const f=j.find(x=>x.id===s.message_id);return e.jsxs(F,{children:[e.jsx(p,{className:"font-medium",children:s.name}),e.jsx(p,{children:f?.name||"N/A"}),e.jsx(p,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:s.target_account_types.map(x=>e.jsx(g,{variant:"outline",className:"text-xs",children:x},x))})}),e.jsx(p,{children:e.jsx("div",{className:"flex space-x-1",children:s.channels.filter(x=>x.is_enabled).map(x=>e.jsx("div",{className:"flex items-center",children:ge(x.type)},x.type))})}),e.jsx(p,{children:e.jsx(g,{variant:"outline",children:s.trigger_type})}),e.jsx(p,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{variant:s.is_active?"default":"secondary",children:s.is_active?"Ativo":"Inativo"}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>{const x=r.map(Z=>Z.id===s.id?{...Z,is_active:!Z.is_active}:Z);y(x)},children:s.is_active?e.jsx(Pe,{className:"h-4 w-4"}):e.jsx(ce,{className:"h-4 w-4"})})]})}),e.jsx(p,{className:"text-right",children:e.jsxs(Y,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(m,{variant:"ghost",className:"h-8 w-8 p-0",children:e.jsx(de,{className:"h-4 w-4"})})}),e.jsxs(se,{align:"end",children:[e.jsxs(P,{onClick:()=>{R(s),a(!0)},children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),"Editar"]}),e.jsxs(P,{className:"text-red-600",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Excluir"]})]})]})})]},s.id)})})]})})]})}),e.jsx(z,{value:"analytics",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(T,{children:[e.jsx(M,{children:e.jsx(A,{children:"Performance por Canal"})}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{className:"h-4 w-4"}),e.jsx("span",{children:"Email"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium",children:"68% abertura"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"1,247 enviados"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{children:"WhatsApp"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium",children:"89% entrega"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"456 enviados"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{className:"h-4 w-4"}),e.jsx("span",{children:"In-App"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium",children:"92% visualização"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"789 enviados"})]})]})]})})]}),e.jsxs(T,{children:[e.jsx(M,{children:e.jsx(A,{children:"Mensagens Mais Enviadas"})}),e.jsx(k,{children:e.jsx("div",{className:"space-y-4",children:j.slice(0,3).map((s,f)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.title})]}),e.jsxs(g,{variant:"outline",children:["#",f+1]})]},s.id))})})]})]})})]}),e.jsx(Ie,{open:l,onOpenChange:c,message:N,onSave:s=>{if(N){const f=j.map(x=>x.id===N.id?{...x,...s}:x);u(f)}else{const f={id:`msg-${Date.now()}`,...s,is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),created_by:"current-admin",attachments:[]};u([...j,f])}C(null),c(!1)}}),e.jsx(Ve,{open:w,onOpenChange:a,rule:D,messages:j,onSave:s=>{if(D){const f=r.map(x=>x.id===D.id?{...x,...s}:x);y(f)}else{const f={id:`rule-${Date.now()}`,...s,is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),created_by:"current-admin"};y([...r,f])}R(null),a(!1)}}),e.jsx(qe,{open:i,onOpenChange:S,history:d,messages:j,rules:r})]})}export{Je as default};
