import{M as z,r as o,j as e,D as O,v as k,w as A,x as G,af as l,ag as j,aR as H,E as v,H as b,I as N,J as f,K as c,ah as L,f as C,bV as x}from"./index-D2dOrPZ8.js";function R({open:u,onClose:p,onSubmit:F,initialData:s}){const{toast:m}=z(),[_,S]=o.useState(!1),[E,P]=o.useState([]),[w,I]=o.useState([]),[r,g]=o.useState({}),[t,h]=o.useState({name:"",description:"",client_id:"",manager_id:"",status:"planning",start_date:"",end_date:"",budget:""});o.useEffect(()=>{u&&(async()=>{try{const[i,d]=await Promise.all([x.getClients(),x.getUsers()]);P(i),I(d.filter(y=>y.role==="manager"||y.role==="admin"))}catch{m({title:"Erro",description:"Falha ao carregar dados do formulário",variant:"destructive"})}})()},[u,m]),o.useEffect(()=>{h(s?{name:s.name||"",description:s.description||"",client_id:s.client_id?.toString()||"",manager_id:s.manager_id?.toString()||"",status:s.status||"planning",start_date:s.start_date||"",end_date:s.end_date||"",budget:s.budget?.toString()||""}:{name:"",description:"",client_id:"",manager_id:"",status:"planning",start_date:"",end_date:"",budget:""}),g({})},[s,u]);const D=()=>{const a={};return t.name.trim()||(a.name="Nome do projeto é obrigatório"),t.client_id||(a.client_id="Cliente é obrigatório"),t.manager_id||(a.manager_id="Gerente é obrigatório"),g(a),Object.keys(a).length===0},V=async a=>{if(a.preventDefault(),!!D()){S(!0);try{const i={name:t.name,description:t.description,client_id:Number.parseInt(t.client_id),manager_id:Number.parseInt(t.manager_id),status:t.status,start_date:t.start_date||void 0,end_date:t.end_date||void 0,budget:t.budget?Number.parseFloat(t.budget):void 0};let d;s?(d=await x.updateProject(s.id,i),m({title:"Sucesso",description:"Projeto atualizado com sucesso"})):(d=await x.createProject(i),m({title:"Sucesso",description:"Projeto criado com sucesso"})),F(d),p()}catch{m({title:"Erro",description:`Falha ao ${s?"atualizar":"criar"} projeto`,variant:"destructive"})}finally{S(!1)}}},T=()=>{h({name:"",description:"",client_id:"",manager_id:"",status:"planning",start_date:"",end_date:"",budget:""}),g({}),p()},n=(a,i)=>{h(d=>({...d,[a]:i})),r[a]&&g(d=>({...d,[a]:void 0}))};return e.jsx(O,{open:u,onOpenChange:p,children:e.jsxs(k,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(A,{children:e.jsx(G,{children:s?"Editar Projeto":"Novo Projeto"})}),e.jsxs("form",{onSubmit:V,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"name",children:"Nome do Projeto *"}),e.jsx(j,{id:"name",placeholder:"Digite o nome do projeto",value:t.name,onChange:a=>n("name",a.target.value),className:r.name?"border-red-500":""}),r.name&&e.jsx("p",{className:"text-sm text-red-500",children:r.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"description",children:"Descrição"}),e.jsx(H,{id:"description",placeholder:"Descreva o projeto",rows:3,value:t.description,onChange:a=>n("description",a.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"client",children:"Cliente *"}),e.jsxs(v,{value:t.client_id,onValueChange:a=>n("client_id",a),children:[e.jsx(b,{className:r.client_id?"border-red-500":"",children:e.jsx(N,{placeholder:"Selecione um cliente"})}),e.jsx(f,{children:E.map(a=>e.jsx(c,{value:a.id.toString(),children:a.name},a.id))})]}),r.client_id&&e.jsx("p",{className:"text-sm text-red-500",children:r.client_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"manager",children:"Gerente *"}),e.jsxs(v,{value:t.manager_id,onValueChange:a=>n("manager_id",a),children:[e.jsx(b,{className:r.manager_id?"border-red-500":"",children:e.jsx(N,{placeholder:"Selecione um gerente"})}),e.jsx(f,{children:w.map(a=>e.jsx(c,{value:a.id.toString(),children:a.name},a.id))})]}),r.manager_id&&e.jsx("p",{className:"text-sm text-red-500",children:r.manager_id})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"status",children:"Status"}),e.jsxs(v,{value:t.status,onValueChange:a=>n("status",a),children:[e.jsx(b,{children:e.jsx(N,{})}),e.jsxs(f,{children:[e.jsx(c,{value:"planning",children:"Planejamento"}),e.jsx(c,{value:"active",children:"Ativo"}),e.jsx(c,{value:"on_hold",children:"Em Espera"}),e.jsx(c,{value:"completed",children:"Concluído"}),e.jsx(c,{value:"cancelled",children:"Cancelado"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"start_date",children:"Data de Início"}),e.jsx(j,{id:"start_date",type:"date",value:t.start_date,onChange:a=>n("start_date",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"end_date",children:"Data de Fim"}),e.jsx(j,{id:"end_date",type:"date",value:t.end_date,onChange:a=>n("end_date",a.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"budget",children:"Orçamento"}),e.jsx(j,{id:"budget",type:"number",step:"0.01",placeholder:"0.00",value:t.budget,onChange:a=>n("budget",a.target.value)})]}),e.jsxs(L,{className:"gap-2",children:[e.jsx(C,{type:"button",variant:"outline",onClick:T,disabled:_,children:"Cancelar"}),e.jsx(C,{type:"submit",disabled:_,children:_?"Salvando...":s?"Atualizar":"Criar"})]})]})]})})}export{R as P};
